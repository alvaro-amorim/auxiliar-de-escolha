<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Comerc IAs — Orçamento Instantâneo</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Sora:wght@500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Brand */
      --b900:#062352;
      --b800:#0A2E6B;
      --b700:#0B46B0;
      --b600:#0B5FFF;
      --b500:#2E7BFF;
      --b100:#EAF2FF;

      /* Theme (light defaults) */
      --bgA:#F7FBFF;
      --bgB:#FFFFFF;
      --grid: rgba(11,95,255,.06);

      --surface: rgba(255,255,255,.74);
      --surface2: rgba(255,255,255,.86);
      --badge: rgba(255,255,255,.70);
      --stroke: rgba(11,95,255,.14);

      --text: rgba(6,35,82,1);
      --text2:#0b1220;
      --muted: rgba(6,35,82,.62);
      --shadow1: rgba(6,35,82,.16);
      --shadow2: rgba(6,35,82,.10);
      --soft1: rgba(6,35,82,.08);
      --soft2: rgba(6,35,82,.06);

      --divider: rgba(11,95,255,.24);
      --scrollThumb: rgba(11,95,255,.18);
      --scrollTrack: rgba(11,95,255,.05);

      --focus: rgba(11,95,255,.18);

      /* For “invert” feel */
      --cardText: rgba(6,35,82,1);
      --cardMuted: rgba(6,35,82,.62);
    }

    /* Dark Mode (inverted) */
    [data-theme="dark"]{
      --bgA: #04142f;
      --bgB: #031029;
      --grid: rgba(234,242,255,.06);

      --surface: rgba(4,20,47,.72);
      --surface2: rgba(4,20,47,.84);
      --badge: rgba(4,20,47,.62);
      --stroke: rgba(234,242,255,.12);

      --text: rgba(234,242,255,1);
      --text2: rgba(234,242,255,1);
      --muted: rgba(234,242,255,.70);
      --shadow1: rgba(0,0,0,.40);
      --shadow2: rgba(0,0,0,.26);
      --soft1: rgba(0,0,0,.28);
      --soft2: rgba(0,0,0,.18);

      --divider: rgba(234,242,255,.16);
      --scrollThumb: rgba(234,242,255,.16);
      --scrollTrack: rgba(234,242,255,.05);

      --focus: rgba(234,242,255,.14);

      --cardText: rgba(234,242,255,1);
      --cardMuted: rgba(234,242,255,.70);
    }

    html,body{ height:100%; }
    body{
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text2);
      background:
        radial-gradient(1200px 720px at 12% 10%, rgba(11,95,255,.14), transparent 55%),
        radial-gradient(900px 520px at 92% 0%, rgba(11,95,255,.10), transparent 48%),
        linear-gradient(180deg, var(--bgA), var(--bgB) 55%);
    }
    [data-theme="dark"] body{
      background:
        radial-gradient(1200px 720px at 14% 12%, rgba(11,95,255,.20), transparent 55%),
        radial-gradient(900px 520px at 90% 0%, rgba(11,95,255,.14), transparent 48%),
        radial-gradient(700px 420px at 50% 110%, rgba(46,123,255,.10), transparent 55%),
        linear-gradient(180deg, var(--bgA), var(--bgB) 55%);
    }

    h1,h2,h3,.font-display{ font-family: Sora, Inter, system-ui, sans-serif; }

    .bg-grid{
      background-image:
        linear-gradient(to right, var(--grid) 1px, transparent 1px),
        linear-gradient(to bottom, var(--grid) 1px, transparent 1px);
      background-size: 56px 56px;
      background-position: center;
      mask-image: radial-gradient(circle at 50% 10%, black 40%, transparent 80%);
    }

    .premium{
      position: relative;
      border-radius: 28px;
      background: var(--surface);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow:
        0 26px 70px var(--shadow1),
        0 8px 22px var(--shadow2);
      overflow: hidden;
      border: 1px solid rgba(11,95,255,.06);
    }
    [data-theme="dark"] .premium{
      border: 1px solid rgba(234,242,255,.06);
    }
    .premium::before{
      content:"";
      position:absolute;
      inset:0;
      padding:1px;
      border-radius: 28px;
      background: linear-gradient(135deg, rgba(11,95,255,.55), rgba(255,255,255,.18), rgba(11,95,255,.22));
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events:none;
    }
    [data-theme="dark"] .premium::before{
      background: linear-gradient(135deg, rgba(11,95,255,.60), rgba(234,242,255,.10), rgba(11,95,255,.28));
    }

    .fade{ opacity:0; transform: translateY(10px); transition: all .28s ease; }
    .fade.show{ opacity:1; transform: translateY(0); }

    .ring-brand:focus{
      outline:none;
      box-shadow: 0 0 0 5px var(--focus);
    }

    .btn{ border-radius: 16px; transition: transform .12s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease, color .18s ease; will-change: transform; }
    .btn:active{ transform: translateY(1px); }

    .btn-primary{
      background: linear-gradient(180deg, rgba(11,95,255,1), rgba(10,72,190,1));
      box-shadow: 0 14px 30px rgba(11,95,255,.22);
    }
    .btn-primary:hover{
      box-shadow: 0 18px 40px rgba(11,95,255,.26);
      filter: saturate(1.05);
    }

    .card{
      border-radius: 20px;
      border: 1px solid var(--stroke);
      background: var(--surface2);
      box-shadow: 0 12px 30px var(--soft1);
    }

    .option{
      border-radius: 20px;
      border: 1px solid rgba(11,95,255,.16);
      background: var(--surface2);
      box-shadow: 0 10px 24px var(--soft2);
      transition: transform .12s ease, box-shadow .18s ease, border-color .18s ease;
    }
    [data-theme="dark"] .option{
      border: 1px solid rgba(234,242,255,.12);
      background: rgba(4,20,47,.82);
      box-shadow: 0 16px 36px rgba(0,0,0,.25);
    }
    .option:hover{
      transform: translateY(-2px);
      border-color: rgba(11,95,255,.30);
      box-shadow: 0 18px 40px var(--soft1);
    }
    [data-theme="dark"] .option:hover{
      border-color: rgba(46,123,255,.38);
      box-shadow: 0 18px 46px rgba(0,0,0,.34);
    }

    .badge{
      border-radius: 999px;
      border: 1px solid rgba(11,95,255,.16);
      background: var(--badge);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      color: var(--muted);
    }
    [data-theme="dark"] .badge{
      border: 1px solid rgba(234,242,255,.12);
    }

    .divider{
      height:1px;
      background: linear-gradient(90deg, transparent, var(--divider), transparent);
    }

    .scrollbar::-webkit-scrollbar{ width: 10px; height:10px; }
    .scrollbar::-webkit-scrollbar-thumb{ background: var(--scrollThumb); border-radius: 999px; border: 2px solid rgba(255,255,255,.6); }
    [data-theme="dark"] .scrollbar::-webkit-scrollbar-thumb{ border: 2px solid rgba(4,20,47,.8); }
    .scrollbar::-webkit-scrollbar-track{ background: var(--scrollTrack); border-radius: 999px; }

    summary { list-style: none; }
    summary::-webkit-details-marker { display:none; }
    .chev{ transition: transform .18s ease; }
    details[open] .chev{ transform: rotate(180deg); }

    .muted{ color: var(--muted); }

    .i{ width: 18px; height: 18px; color: rgba(11,95,255,.95); flex: none; }
    [data-theme="dark"] .i{ color: rgba(234,242,255,.92); }
    .i.brand{ color: rgba(11,95,255,.95); }
    [data-theme="dark"] .i.brand{ color: rgba(46,123,255,.95); }

    .offer-feature{
      position: relative;
      overflow: hidden;
    }
    .offer-feature::after{
      content:"";
      position:absolute;
      inset:-60px -60px auto auto;
      width: 220px;
      height: 220px;
      background: radial-gradient(circle at 30% 30%, rgba(11,95,255,.22), transparent 60%);
      transform: rotate(12deg);
      pointer-events:none;
    }
    [data-theme="dark"] .offer-feature::after{
      background: radial-gradient(circle at 30% 30%, rgba(46,123,255,.18), transparent 62%);
    }

    /* Persistent Links (always visible) */
    .floating-links{
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 50;
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 10px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: var(--surface);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow: 0 18px 46px var(--shadow2);
    }
    .floating-links .fab{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(11,95,255,.18);
      background: rgba(255,255,255,.70);
      color: var(--text);
      font-weight: 800;
      font-family: Sora, Inter, system-ui, sans-serif;
      font-size: 13px;
      letter-spacing: -.01em;
      transition: transform .12s ease, box-shadow .18s ease, border-color .18s ease, background .18s ease;
      white-space: nowrap;
    }
    [data-theme="dark"] .floating-links .fab{
      background: rgba(4,20,47,.80);
      color: var(--text);
      border: 1px solid rgba(234,242,255,.12);
    }
    .floating-links .fab:hover{
      transform: translateY(-2px);
      border-color: rgba(11,95,255,.34);
      box-shadow: 0 16px 40px var(--soft1);
    }
    .floating-links .fab.primary{
      background: linear-gradient(180deg, rgba(11,95,255,1), rgba(10,72,190,1));
      color: #fff;
      border-color: rgba(11,95,255,.28);
      box-shadow: 0 12px 26px rgba(11,95,255,.22);
    }
    .floating-links .fab.primary:hover{
      box-shadow: 0 18px 40px rgba(11,95,255,.26);
    }
    .floating-links .fab .mini{
      width: 36px;
      height: 36px;
      border-radius: 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(11,95,255,.10);
      border: 1px solid rgba(11,95,255,.12);
    }
    [data-theme="dark"] .floating-links .fab .mini{
      background: rgba(46,123,255,.12);
      border: 1px solid rgba(234,242,255,.10);
    }
    .floating-links .fab.primary .mini{
      background: rgba(255,255,255,.14);
      border: 1px solid rgba(255,255,255,.18);
    }
    .floating-links .fab.compact{
      padding: 10px 12px;
    }
    .floating-links .fab.compact span{
      display:none;
    }

    /* Mobile: turn into a bottom bar */
    @media (max-width: 640px){
      .floating-links{
        left: 12px;
        right: 12px;
        bottom: 12px;
        border-radius: 22px;
        justify-content: space-between;
        padding: 10px;
      }
      .floating-links .fab{
        flex: 1;
        justify-content: center;
        padding: 12px 10px;
        font-size: 13px;
      }
      .floating-links .fab.compact span{
        display: inline;
      }
      .floating-links .fab .mini{
        width: 34px;
        height: 34px;
        border-radius: 14px;
      }
    }
  </style>
</head>

<body>
  <div class="absolute inset-0 bg-grid pointer-events-none"></div>

  <!-- Persistent buttons -->
  <div class="floating-links" aria-label="Links fixos">
    <a id="siteLink" class="fab primary ring-brand" href="https://www.comercias.com.br/pt" target="_blank" rel="noopener noreferrer">
      <span class="mini" aria-hidden="true">
        <svg class="i brand" viewBox="0 0 24 24" fill="none">
          <path d="M12 2a10 10 0 100 20 10 10 0 000-20Z" stroke="currentColor" stroke-width="1.8"/>
          <path d="M2 12h20" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          <path d="M12 2c3 2.5 5 6.7 5 10s-2 7.5-5 10c-3-2.5-5-6.7-5-10S9 4.5 12 2Z" stroke="currentColor" stroke-width="1.8"/>
        </svg>
      </span>
      <span id="siteLabel">Site</span>
    </a>

    <a id="igLink" class="fab ring-brand" href="https://www.instagram.com/comerc_ias?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==" target="_blank" rel="noopener noreferrer">
      <span class="mini" aria-hidden="true">
        <svg class="i brand" viewBox="0 0 24 24" fill="none">
          <path d="M7 2h10a5 5 0 015 5v10a5 5 0 01-5 5H7a5 5 0 01-5-5V7a5 5 0 015-5Z" stroke="currentColor" stroke-width="1.8"/>
          <path d="M12 8a4 4 0 100 8 4 4 0 000-8Z" stroke="currentColor" stroke-width="1.8"/>
          <path d="M17.6 6.4h.01" stroke="currentColor" stroke-width="3.2" stroke-linecap="round"/>
        </svg>
      </span>
      <span id="igLabel">Instagram</span>
    </a>

    <button id="themeBtn" class="fab compact ring-brand" type="button" aria-label="Alternar tema" title="Alternar tema">
      <span class="mini" aria-hidden="true" id="themeIcon">
        <!-- icon injected -->
      </span>
      <span id="themeLabel">Modo escuro</span>
    </button>
  </div>

  <div class="min-h-screen flex items-center justify-center p-4 sm:p-6 md:p-10">
    <div class="premium w-full max-w-6xl">
      <!-- Header -->
      <div class="px-5 sm:px-7 py-5 flex items-center justify-between gap-3">
        <div class="flex items-center gap-3">
          <div class="w-11 h-11 rounded-2xl flex items-center justify-center text-white font-display font-extrabold"
               style="background: linear-gradient(180deg, rgba(11,95,255,1), rgba(10,72,190,1)); box-shadow: 0 14px 30px rgba(11,95,255,.24);">
            CI
          </div>

          <div class="leading-tight">
            <div class="font-display font-extrabold text-[15px] sm:text-[16px] tracking-tight" style="color: var(--text);">
              Comerc <span style="color: rgba(11,95,255,1);">IAs</span>
            </div>
            <div id="brandSub" class="text-xs muted">Orçamento premium • rápido e profissional</div>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <div class="badge p-1 flex items-center gap-1">
            <button id="langPT" class="btn ring-brand px-3 py-1.5 text-sm font-semibold text-white"
              style="background: linear-gradient(180deg, rgba(11,95,255,1), rgba(10,72,190,1));">
              PT
            </button>
            <button id="langEN" class="btn ring-brand px-3 py-1.5 text-sm font-semibold hover:bg-[rgba(234,242,255,.55)]"
              style="color: rgba(11,95,255,1);">
              EN
            </button>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <!-- Hero -->
      <div class="px-5 sm:px-7 pt-6 pb-4 sm:pt-7 sm:pb-6">
        <div class="card p-5 sm:p-6">
          <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <div>
              <div class="badge inline-flex items-center gap-2 px-3 py-1.5 text-xs font-bold tracking-wide" style="color: rgba(11,95,255,1);">
                <svg class="i brand" viewBox="0 0 24 24" fill="none"><path d="M12 2l8.5 4.9v10.2L12 22l-8.5-4.9V6.9L12 2z" stroke="currentColor" stroke-width="1.6"/></svg>
                <span id="heroBadge">ORÇAMENTO INSTANTÂNEO</span>
              </div>

              <h1 id="heroTitle" class="font-display text-2xl sm:text-3xl font-extrabold mt-3 tracking-tight" style="color: var(--text);">
                Escolha entre 3 ofertas claras
              </h1>

              <p id="heroSubtitle" class="mt-2 text-sm sm:text-base muted max-w-2xl">
                Responda o quiz, veja 3 opções (essencial, custo-benefício e avançada) e finalize em 1 clique.
              </p>
            </div>

            <div class="grid grid-cols-3 gap-2 w-full lg:w-auto">
              <div class="badge px-4 py-3 text-center">
                <div class="font-display font-extrabold" style="color: var(--text);" id="kpi1">5</div>
                <div class="text-xs muted" id="kpi1d">Perguntas</div>
              </div>
              <div class="badge px-4 py-3 text-center">
                <div class="font-display font-extrabold" style="color: var(--text);" id="kpi2">3</div>
                <div class="text-xs muted" id="kpi2d">Ofertas</div>
              </div>
              <div class="badge px-4 py-3 text-center">
                <div class="font-display font-extrabold" style="color: var(--text);" id="kpi3">1 clique</div>
                <div class="text-xs muted" id="kpi3d">Finalizar</div>
              </div>
            </div>
          </div>

          <div class="mt-5 flex flex-col sm:flex-row gap-2">
            <button id="startBtn" class="btn btn-primary ring-brand text-white px-5 py-3 font-display font-extrabold w-full sm:w-auto">
              Começar agora
            </button>
            <button id="resetBtnTop" class="btn ring-brand px-5 py-3 font-display font-bold w-full sm:w-auto border hover:bg-[rgba(234,242,255,.35)]"
              style="border-color: rgba(11,95,255,.18); background: rgba(255,255,255,.55); color: rgba(11,95,255,1);">
              Reiniciar
            </button>
          </div>

          <p id="heroNote" class="mt-3 text-xs muted">
            No final você escolhe uma oferta e (se quiser) ajusta detalhes sem confusão.
          </p>
        </div>
      </div>

      <!-- App -->
      <div class="px-5 sm:px-7 pb-7">
        <div id="app"></div>
      </div>

      <div class="divider"></div>

      <!-- Footer -->
      <div class="px-5 sm:px-7 py-5 text-xs muted flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
        <div id="footerLeft">© Comerc IAs • Atendimento rápido e profissional</div>
        <div id="footerRight">Design premium azul & branco</div>
      </div>
    </div>
  </div>

  <!-- Embedded catalog (NO fetch) -->
  <script type="application/json" id="catalog">
{
  "orcamento": {
    "categorias": [
      {
        "nome": "Imagens",
        "servicos": [
          { "titulo": "5 imagens", "titulo_venda": "Pack Visual Rápido — 5 artes", "descricao": "Criação de até 5 artes originais pensadas para redes sociais ou anúncios.", "inclui": ["5 imagens em alta resolução","Otimização para redes sociais"], "beneficios": ["Entrega rápida","Arquivos prontos para publicação"], "prazo_entrega": "1 dia útil", "revisoes_incluidas": 2, "preco_original": 50, "preco": 45 },
          { "titulo": "10 imagens", "titulo_venda": "Pack Engajamento — 10 artes", "descricao": "Série de 10 artes alinhadas à sua identidade visual ou campanha.", "inclui": ["10 imagens em alta resolução","Variações para testes"], "beneficios": ["Economia por volume","Mais consistência"], "prazo_entrega": "1 dia útil", "revisoes_incluidas": 3, "preco_original": 80, "preco": 80 },
          { "titulo": "15 imagens", "titulo_venda": "Pack Crescimento — 15 artes", "descricao": "15 artes com identidade sólida, pronto para calendário mensal.", "inclui": ["15 imagens em alta resolução","2 variações quando aplicável"], "beneficios": ["Banco de conteúdo","Planejamento coeso"], "prazo_entrega": "2 dias úteis", "revisoes_incluidas": 4, "preco_original": 110, "preco": 110 }
        ]
      },
      {
        "nome": "Vídeos",
        "servicos": [
          { "titulo": "Vídeo Rápido", "titulo_venda": "Vídeo Short — até 15s", "descricao": "Vídeo curto otimizado para Reels / Shorts / Tiktok.", "inclui": ["Edição completa","Legendas básicas"], "beneficios": ["Alto impacto","Pronto para impulsionamento"], "prazo_entrega": "1 dia útil", "revisoes_incluidas": 1, "preco_original": 70, "preco": 70 },
          { "titulo": "Vídeo Simples", "titulo_venda": "Vídeo Storytelling — até 30s", "descricao": "Vídeo de 30 segundos com narrativa simples.", "inclui": ["Storytelling","Legendas embutidas"], "beneficios": ["Formato versátil","Entrega rápida"], "prazo_entrega": "1 dia útil", "revisoes_incluidas": 2, "preco_original": 140, "preco": 125 },
          { "titulo": "Vídeo Premium", "titulo_venda": "Vídeo Premium — até 60s", "descricao": "Vídeo com edição refinada e narrativa estruturada.", "inclui": ["Edição completa","Lower thirds"], "beneficios": ["Peça de alta conversão","Resultado profissional"], "prazo_entrega": "2 dias úteis", "revisoes_incluidas": 3, "preco_original": 240, "preco": 240 },
          { "titulo": "Vídeo Elaborado", "titulo_venda": "Vídeo Pro — até 120s (Efeitos especiais)", "descricao": "Vídeo com efeitos, composições e cenas mais elaboradas.", "inclui": ["Efeitos visuais","Motion simples"], "beneficios": ["Alto impacto visual","Uso institucional"], "prazo_entrega": "2 dias úteis", "revisoes_incluidas": 4, "preco_original": 380, "preco": 380 }
        ]
      },
      {
        "nome": "Planos de Social Media (Conteúdo Mensal)",
        "servicos": [
          { "titulo": "Plano Básico", "titulo_venda": "Plano Conteúdo Básico", "descricao": "10 Artes + 120s em Vídeos por mês.", "inclui": ["10 artes","120s vídeo"], "beneficios": ["Consistência","Bom custo-benefício"], "prazo_entrega": "Entrega semanal", "revisoes_incluidas": 1,
            "precos_por_periodo": [
              { "periodo": "Mensal", "meses": 1, "desconto_perc": 0, "preco_total_sem_desc": 400, "preco_total_com_desc": 400, "preco_mensal_efetivo": 400 },
              { "periodo": "Trimestral", "meses": 3, "desconto_perc": 5, "preco_total_sem_desc": 1200, "preco_total_com_desc": 1140, "preco_mensal_efetivo": 380 },
              { "periodo": "Semestral", "meses": 6, "desconto_perc": 10, "preco_total_sem_desc": 2400, "preco_total_com_desc": 2160, "preco_mensal_efetivo": 360 },
              { "periodo": "Anual", "meses": 12, "desconto_perc": 15, "preco_total_sem_desc": 4800, "preco_total_com_desc": 4080, "preco_mensal_efetivo": 340 }
            ]
          },
          { "titulo": "Plano Standart", "titulo_venda": "Plano Conteúdo Standart", "descricao": "20 Artes + 240s em Vídeos por mês.", "inclui": ["20 artes","240s vídeo"], "beneficios": ["Alta frequência","Variedade"], "prazo_entrega": "Entrega semanal", "revisoes_incluidas": 2,
            "precos_por_periodo": [
              { "periodo": "Mensal", "meses": 1, "desconto_perc": 0, "preco_total_sem_desc": 800, "preco_total_com_desc": 800, "preco_mensal_efetivo": 800 },
              { "periodo": "Trimestral", "meses": 3, "desconto_perc": 5, "preco_total_sem_desc": 2400, "preco_total_com_desc": 2280, "preco_mensal_efetivo": 760 },
              { "periodo": "Semestral", "meses": 6, "desconto_perc": 10, "preco_total_sem_desc": 4800, "preco_total_com_desc": 4320, "preco_mensal_efetivo": 720 },
              { "periodo": "Anual", "meses": 12, "desconto_perc": 15, "preco_total_sem_desc": 9600, "preco_total_com_desc": 8160, "preco_mensal_efetivo": 680 }
            ]
          },
          { "titulo": "Plano Premium", "titulo_venda": "Plano Conteúdo Premium", "descricao": "40 Artes + 320s em Vídeos por mês.", "inclui": ["40 artes","320s vídeo"], "beneficios": ["Máxima presença","Suporte ampliado"], "prazo_entrega": "Entrega semanal", "revisoes_incluidas": 2,
            "precos_por_periodo": [
              { "periodo": "Mensal", "meses": 1, "desconto_perc": 0, "preco_total_sem_desc": 1200, "preco_total_com_desc": 1200, "preco_mensal_efetivo": 1200 },
              { "periodo": "Trimestral", "meses": 3, "desconto_perc": 5, "preco_total_sem_desc": 3600, "preco_total_com_desc": 3420, "preco_mensal_efetivo": 1140 },
              { "periodo": "Semestral", "meses": 6, "desconto_perc": 10, "preco_total_sem_desc": 7200, "preco_total_com_desc": 6480, "preco_mensal_efetivo": 1080 },
              { "periodo": "Anual", "meses": 12, "desconto_perc": 15, "preco_total_sem_desc": 14400, "preco_total_com_desc": 12240, "preco_mensal_efetivo": 1020 }
            ]
          }
        ]
      },
      {
        "nome": "Serviços Avulsos",
        "servicos": [
          { "titulo": "Narração profissional IA", "titulo_venda": "Voz Profissional (IA) — por bloco", "descricao": "Narração por IA com entonação natural.", "inclui": ["WAV/MP3","Ajuste básico"], "beneficios": ["Rápido","Custo-efetivo"], "prazo_entrega": "6–12 horas", "revisoes_incluidas": 2, "preco_original": 25, "preco": 25 },
          { "titulo": "Cartaz de divulgação", "titulo_venda": "Poster Promocional — Arte personalizada", "descricao": "Criação de cartaz para eventos e promoções.", "inclui": ["Impressão e web"], "beneficios": ["Visual profissional"], "prazo_entrega": "1 dia útil", "revisoes_incluidas": 2, "preco_original": 50, "preco": 50 },
          { "titulo": "Edição de foto com IA", "titulo_venda": "Retoque Rápido — por foto", "descricao": "Melhoria e tratamento de imagem.", "inclui": ["Recorte","Ajuste de cor"], "beneficios": ["Melhora visual"], "prazo_entrega": "1 dia útil", "revisoes_incluidas": 1, "preco_original": 25, "preco": 25 },
          { "titulo": "Ensaio de produto", "titulo_venda": "Shooting Compact — 10 fotos + 2 vídeos", "descricao": "10 fotos tratadas + 2 vídeos até 30s.", "inclui": ["10 fotos","2 vídeos"], "beneficios": ["Conteúdo para e-commerce"], "prazo_entrega": "3 dias úteis", "revisoes_incluidas": 4, "preco_original": 330, "preco": 299 },
          { "titulo": "Criação de logomarca", "titulo_venda": "Identidade Visual Básica — logomarca", "descricao": "Criação de logotipo com conceitos alinhados à marca.", "inclui": ["3 propostas","Arquivos finais"], "beneficios": ["Base de identidade visual"], "prazo_entrega": "1 dia útil", "revisoes_incluidas": 4, "preco_original": 100, "preco": 100 },
          { "titulo": "Trilha sonora IA", "titulo_venda": "Trilha Sonora Exclusiva por IA", "descricao": "Composição musical gerada sob briefing.", "inclui": ["Faixa exclusiva","Versões loop"], "beneficios": ["Sem direitos autorais"], "prazo_entrega": "2 dias úteis", "revisoes_incluidas": 2, "preco_original": 170, "preco": 170 },
          { "titulo": "Dublagem IA", "titulo_venda": "Dublagem profissional por IA", "descricao": "Dublagem em qualquer idioma (até 15 min).", "inclui": ["1 idioma","Legendas"], "beneficios": ["Expansão internacional"], "prazo_entrega": "3 dias úteis", "revisoes_incluidas": 2, "preco_original": 300, "preco": 300 },
          { "titulo": "Site empresarial personalizado", "titulo_venda": "Website Corporativo Básico", "descricao": "Website institucional com design responsivo.", "inclui": ["Home + 4 páginas","Responsivo"], "beneficios": ["Presença profissional"], "prazo_entrega": "5 dias úteis", "revisoes_incluidas": 4, "preco_original": 650, "preco": 590 }
        ]
      },
      {
        "nome": "Criação de Personagem Personalizado",
        "servicos": [
          { "titulo": "Personagem estático", "titulo_venda": "Mascote Ilustrado — 5 poses", "descricao": "Personagem estático com 5 poses.", "inclui": ["5 poses"], "beneficios": ["Identidade única"], "prazo_entrega": "1 dia útil", "revisoes_incluidas": 4, "preco_original": 170, "preco": 170 },
          { "titulo": "Personagem animado (curto)", "titulo_venda": "Mascote Animado — 30s + narração", "descricao": "Animação curta com narração.", "inclui": ["30s","Narração"], "beneficios": ["Mais engajamento"], "prazo_entrega": "1 dia útil", "revisoes_incluidas": 3, "preco_original": 290, "preco": 290 },
          { "titulo": "Personagem animado (longo)", "titulo_venda": "Mascote Cinemático — 1 min + narração", "descricao": "Animação de 1 minuto com narrativa.", "inclui": ["60s","Narração"], "beneficios": ["Peça forte para campanhas"], "prazo_entrega": "2 dias úteis", "revisoes_incluidas": 4, "preco_original": 420, "preco": 420 }
        ]
      },
      {
        "nome": "Pacotes de Personagem Personalizado",
        "servicos": [
          { "titulo": "Pacote básico", "titulo_venda": "Starter Pack — 1x 30s + 3 poses", "descricao": "1 vídeo 30s + 3 poses.", "inclui": ["30s","3 poses"], "beneficios": ["Multimídia"], "prazo_entrega": "1 dia útil", "revisoes_incluidas": 2, "preco_original": 420, "preco": 420 },
          { "titulo": "Pacote standart", "titulo_venda": "Brand Pack — 1x 1min + 3 poses", "descricao": "1 vídeo 60s + 3 poses.", "inclui": ["60s","3 poses"], "beneficios": ["Campanhas"], "prazo_entrega": "2 dias úteis", "revisoes_incluidas": 3, "preco_original": 550, "preco": 550 },
          { "titulo": "Pacote premium", "titulo_venda": "Pro Pack — 3x 30s + 5 poses", "descricao": "3 vídeos 30s + 5 poses.", "inclui": ["3x 30s","5 poses"], "beneficios": ["Presença forte"], "prazo_entrega": "3 dias úteis", "revisoes_incluidas": 4, "preco_original": 750, "preco": 675 },
          { "titulo": "Pacote deluxe", "titulo_venda": "Deluxe Pack — 6x 30s ou 3x 1min", "descricao": "Pacote robusto para lançamentos.", "inclui": ["6x 30s ou 3x 60s"], "beneficios": ["Topo de linha"], "prazo_entrega": "5 dias úteis", "revisoes_incluidas": 6, "preco_original": 1100, "preco": 1100 }
        ]
      }
    ],
    "observacoes": "Descontos progressivos em combos e em parcerias mensais, semestrais ou anuais. Conte sua ideia para a gente!"
  }
}
  </script>

  <script>
  (function(){
    const WHATSAPP_NUMBER = "5532991147944";

    // --- Theme (dark mode) ---
    const THEME_KEY = "comerc_theme";
    const root = document.documentElement;

    function prefersDark(){
      return window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
    }
    function getSavedTheme(){
      const v = localStorage.getItem(THEME_KEY);
      return (v === "dark" || v === "light") ? v : null;
    }
    function setTheme(theme){
      root.setAttribute("data-theme", theme);
      localStorage.setItem(THEME_KEY, theme);
      updateThemeButton();
      // Update language-related buttons (hover colors differ slightly in dark)
      applyLangUI();
    }
    function toggleTheme(){
      const current = root.getAttribute("data-theme") || "light";
      setTheme(current === "dark" ? "light" : "dark");
    }
    function themeIconSun(){
      return `
        <svg class="i brand" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 18a6 6 0 100-12 6 6 0 000 12Z" stroke="currentColor" stroke-width="1.8"/>
          <path d="M12 2v2M12 20v2M4 12H2M22 12h-2M5 5l-1.4-1.4M20.4 20.4L19 19M5 19l-1.4 1.4M20.4 3.6L19 5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
      `;
    }
    function themeIconMoon(){
      return `
        <svg class="i brand" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M21 14.5A8.5 8.5 0 1110.5 3a7 7 0 0010.5 11.5Z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
        </svg>
      `;
    }

    // ---------- i18n ----------
    const I18N = {
      pt: {
        brandSub: "Orçamento premium • rápido e profissional",
        footerLeft: "© Comerc IAs • Atendimento rápido e profissional",
        footerRight: "Design premium azul & branco",
        heroBadge: "ORÇAMENTO INSTANTÂNEO",
        heroTitle: "Escolha entre 3 ofertas claras",
        heroSubtitle: "Responda o quiz, veja 3 opções (essencial, custo-benefício e avançada) e finalize em 1 clique.",
        heroNote: "No final você escolhe uma oferta e (se quiser) ajusta detalhes sem confusão.",
        kpi1d:"Perguntas", kpi2d:"Ofertas", kpi3d:"Finalizar",
        start:"Começar agora",
        restart:"Reiniciar",
        back:"Voltar",
        step:"Pergunta",
        of:"de",
        done:"Finalizar",

        q_goal:"Qual é o seu objetivo principal?",
        goal_sales:"Gerar vendas / conversão",
        goal_brand:"Fortalecer marca / identidade",
        goal_social:"Conteúdo para redes sociais",
        goal_edu:"Educativo / explicativo",
        goal_intl:"Internacionalizar (idiomas)",
        goal_launch:"Lançamento / campanha",

        q_need:"O que você precisa agora?",
        need_images:"Artes e imagens",
        need_videos:"Vídeos (Reels/Ads)",
        need_plan:"Plano mensal de conteúdo",
        need_oneoff:"Serviços avulsos (logo, site, etc.)",
        need_mascot:"Personagem / mascote",
        need_unsure:"Não tenho certeza",

        q_volume:"Qual volume você imagina?",
        vol_low:"Baixo (rápido / essencial)",
        vol_mid:"Médio (consistente)",
        vol_high:"Alto (campanha forte)",
        vol_mega:"Muito alto (máxima presença)",

        q_invest:"Investimento desejado (opcional)",
        inv_skip:"Prefiro não informar",
        inv_100:"Até R$100",
        inv_300:"Até R$300",
        inv_600:"Até R$600",
        inv_1000:"Até R$1.000",
        inv_2000:"Até R$2.000",

        q_deadline:"Prazo desejado (opcional)",
        d1:"Urgente (até 2 dias)",
        d2:"Até 7 dias",
        d3:"Flexível",

        offers_title:"Escolha sua oferta",
        offers_sub:"3 opções claras. Você pode ajustar detalhes depois, sem confusão.",
        offer_simple:"Essencial",
        offer_value:"Custo-benefício",
        offer_advanced:"Avançada",
        offer_best:"MAIS VENDIDA",
        offer_pick:"Escolher esta oferta",
        offer_details:"Ver o que está incluso",
        est_total:"Total estimado",
        you_save:"Você economiza",

        customize_title:"Ajuste fino (opcional)",
        customize_sub:"Deixe do seu jeito. Mantivemos apenas o necessário para não confundir.",
        included:"Incluso na oferta",
        extras:"Extras sugeridos",
        extras_hint:"Poucas opções, só o que faz sentido para o seu objetivo.",
        note_hint:"Descreva rapidamente seu projeto (opcional):",
        send_whatsapp:"Enviar no WhatsApp",
        open_budget:"Abrir orçamento no site",
        obs:"Observação",
        summary:"Resumo do quiz",

        period:"Período",
        plan_total:"Total do período",
        per_month:"/mês",

        wa_intro:"Olá! Quero um orçamento com a Comerc IAs.",
        wa_offer:"Oferta escolhida:",
        wa_answers:"Resumo do quiz:",
        wa_services:"Serviços incluídos:",
        wa_extras:"Extras adicionados:",
        wa_total:"Total estimado:",
        wa_note:"Observações:",

        link_site:"Site",
        link_ig:"Instagram",
        theme_dark:"Modo escuro",
        theme_light:"Modo claro",
        theme_title:"Alternar tema"
      },
      en: {
        brandSub: "Premium quote • fast and professional",
        footerLeft: "© Comerc IAs • Fast and professional service",
        footerRight: "Blue & white premium design",
        heroBadge: "INSTANT QUOTE",
        heroTitle: "Pick from 3 clear offers",
        heroSubtitle: "Answer the quiz, see 3 options (simple, best value, advanced) and finish in 1 click.",
        heroNote: "At the end you pick an offer and (if you want) fine-tune details without confusion.",
        kpi1d:"Questions", kpi2d:"Offers", kpi3d:"Finish",
        start:"Start now",
        restart:"Restart",
        back:"Back",
        step:"Question",
        of:"of",
        done:"Finish",

        q_goal:"What’s your main goal?",
        goal_sales:"Sales / conversion",
        goal_brand:"Brand / identity",
        goal_social:"Social media content",
        goal_edu:"Educational / explanatory",
        goal_intl:"Go international (languages)",
        goal_launch:"Launch / campaign",

        q_need:"What do you need right now?",
        need_images:"Designs & images",
        need_videos:"Videos (Reels/Ads)",
        need_plan:"Monthly content plan",
        need_oneoff:"One-off services (logo, website, etc.)",
        need_mascot:"Character / mascot",
        need_unsure:"Not sure yet",

        q_volume:"What volume are you aiming for?",
        vol_low:"Low (fast / essential)",
        vol_mid:"Medium (consistent)",
        vol_high:"High (strong campaign)",
        vol_mega:"Very high (maximum presence)",

        q_invest:"Desired budget (optional)",
        inv_skip:"Prefer not to say",
        inv_100:"Up to R$100",
        inv_300:"Up to R$300",
        inv_600:"Up to R$600",
        inv_1000:"Up to R$1,000",
        inv_2000:"Up to R$2,000",

        q_deadline:"Desired timeline (optional)",
        d1:"Urgent (up to 2 days)",
        d2:"Up to 7 days",
        d3:"Flexible",

        offers_title:"Choose your offer",
        offers_sub:"3 clear options. You can fine-tune details later—no confusion.",
        offer_simple:"Simple",
        offer_value:"Best value",
        offer_advanced:"Advanced",
        offer_best:"BEST SELLER",
        offer_pick:"Choose this offer",
        offer_details:"See what’s included",
        est_total:"Estimated total",
        you_save:"You save",

        customize_title:"Fine-tune (optional)",
        customize_sub:"Make it yours. We keep it minimal so it stays clear.",
        included:"Included in the offer",
        extras:"Suggested add-ons",
        extras_hint:"Only a few options that match your goal.",
        note_hint:"Add a quick project note (optional):",
        send_whatsapp:"Send on WhatsApp",
        open_budget:"Open quote page",
        obs:"Note",
        summary:"Quiz summary",

        period:"Plan term",
        plan_total:"Term total",
        per_month:"/mo",

        wa_intro:"Hi! I’d like a quote with Comerc IAs.",
        wa_offer:"Chosen offer:",
        wa_answers:"Quiz summary:",
        wa_services:"Included services:",
        wa_extras:"Added add-ons:",
        wa_total:"Estimated total:",
        wa_note:"Notes:",

        link_site:"Website",
        link_ig:"Instagram",
        theme_dark:"Dark mode",
        theme_light:"Light mode",
        theme_title:"Toggle theme"
      }
    };

    const CATEGORY_EN = {
      "Imagens":"Images",
      "Vídeos":"Videos",
      "Planos de Social Media (Conteúdo Mensal)":"Monthly Social Media Plans",
      "Serviços Avulsos":"One-off Services",
      "Criação de Personagem Personalizado":"Custom Character",
      "Pacotes de Personagem Personalizado":"Character Bundles"
    };

    const SERVICE_TITLE_EN = {
      "Pack Visual Rápido — 5 artes":"Quick Visual Pack — 5 designs",
      "Pack Engajamento — 10 artes":"Engagement Pack — 10 designs",
      "Pack Crescimento — 15 artes":"Growth Pack — 15 designs",
      "Vídeo Short — até 15s":"Short Video — up to 15s",
      "Vídeo Storytelling — até 30s":"Storytelling Video — up to 30s",
      "Vídeo Premium — até 60s":"Premium Video — up to 60s",
      "Vídeo Pro — até 120s (Efeitos especiais)":"Pro Video — up to 120s (VFX)",
      "Plano Conteúdo Básico":"Basic Content Plan",
      "Plano Conteúdo Standart":"Standard Content Plan",
      "Plano Conteúdo Premium":"Premium Content Plan",
      "Voz Profissional (IA) — por bloco":"Professional Voice — per block",
      "Poster Promocional — Arte personalizada":"Promotional Poster — custom design",
      "Retoque Rápido — por foto":"Quick Retouch — per photo",
      "Shooting Compact — 10 fotos + 2 vídeos":"Product Shoot — 10 photos + 2 videos",
      "Identidade Visual Básica — logomarca":"Basic Brand Identity — logo",
      "Trilha Sonora Exclusiva por IA":"Exclusive Soundtrack",
      "Dublagem profissional por IA":"Professional Dubbing",
      "Website Corporativo Básico":"Basic Corporate Website",
      "Mascote Ilustrado — 5 poses":"Illustrated Mascot — 5 poses",
      "Mascote Animado — 30s + narração":"Animated Mascot — 30s + voice",
      "Mascote Cinemático — 1 min + narração":"Cinematic Mascot — 1 min + voice",
      "Starter Pack — 1x 30s + 3 poses":"Starter Bundle — 1×30s + 3 poses",
      "Brand Pack — 1x 1min + 3 poses":"Brand Bundle — 1×1min + 3 poses",
      "Pro Pack — 3x 30s + 5 poses":"Pro Bundle — 3×30s + 5 poses",
      "Deluxe Pack — 6x 30s ou 3x 1min":"Deluxe Bundle — 6×30s or 3×1min"
    };

    function detectLang(){
      const qs = new URLSearchParams(location.search);
      const l = (qs.get("lang")||"").toLowerCase();
      if(l==="en") return "en";
      if(l==="pt") return "pt";
      return (navigator.language||"pt").toLowerCase().startsWith("en") ? "en" : "pt";
    }
    let lang = detectLang();

    const app = document.getElementById("app");
    const raw = JSON.parse(document.getElementById("catalog").textContent);
    const catalog = raw.orcamento || raw;
    const categories = Array.isArray(catalog.categorias) ? catalog.categorias : [];
    const OBS = catalog.observacoes || "";

    let answers = {};
    let stepIndex = 0;
    let chosenOffer = null;
    let customState = null;

    const $ = (id)=>document.getElementById(id);
    const t = (k)=>(I18N[lang] && I18N[lang][k]) ? I18N[lang][k] : (I18N.pt[k]||k);

    function updateThemeButton(){
      const theme = root.getAttribute("data-theme") || "light";
      const icon = (theme === "dark") ? themeIconSun() : themeIconMoon();
      const label = (theme === "dark") ? t("theme_light") : t("theme_dark");
      const title = t("theme_title");

      const iconWrap = document.getElementById("themeIcon");
      const lbl = document.getElementById("themeLabel");
      const btn = document.getElementById("themeBtn");

      if(iconWrap) iconWrap.innerHTML = icon;
      if(lbl) lbl.textContent = label;
      if(btn){
        btn.setAttribute("aria-label", title);
        btn.setAttribute("title", title);
      }
    }

    function setFade(html){
      app.innerHTML = html;
      const el = app.querySelector(".fade");
      if(el) requestAnimationFrame(()=>el.classList.add("show"));
    }

    function money(n){
      const val = Number(n||0);
      return new Intl.NumberFormat(lang==="en" ? "en-US" : "pt-BR", {
        style:"currency", currency:"BRL", maximumFractionDigits:0
      }).format(val);
    }

    function catName(c){ return lang==="en" ? (CATEGORY_EN[c]||c) : c; }
    function svcTitle(s){
      const base = s.titulo_venda || s.titulo || "";
      return (lang==="en" ? (SERVICE_TITLE_EN[base]||base) : base);
    }
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    const services = [];
    categories.forEach(cat=>{
      (cat.servicos||[]).forEach(s=>{
        services.push({
          ...s,
          __cat: cat.nome,
          __id: (cat.nome + "|" + (s.titulo_venda || s.titulo)).toLowerCase().replace(/\s+/g,"-")
        });
      });
    });

    const isPlan = (s)=>Array.isArray(s.precos_por_periodo);

    function getPlanPeriod(s, periodo){
      const list = s.precos_por_periodo || [];
      const found = list.find(p=>p.periodo===periodo) || list[0];
      if(!found) return {periodo:"Mensal", meses:1, desconto:0, total:Number(s.preco||0), monthly:Number(s.preco||0)};
      return {
        periodo: found.periodo,
        meses: Number(found.meses||1),
        desconto: Number(found.desconto_perc||0),
        total: Number(found.preco_total_com_desc||0),
        monthly: Number(found.preco_mensal_efetivo||0)
      };
    }

    const steps = [
      {
        id:"goal",
        titleKey:"q_goal",
        options:[
          {k:"goal_sales", v:"sales"},
          {k:"goal_brand", v:"brand"},
          {k:"goal_social", v:"social"},
          {k:"goal_edu", v:"edu"},
          {k:"goal_intl", v:"intl"},
          {k:"goal_launch", v:"launch"}
        ]
      },
      {
        id:"need",
        titleKey:"q_need",
        options:[
          {k:"need_images", v:"images"},
          {k:"need_videos", v:"videos"},
          {k:"need_plan", v:"plan"},
          {k:"need_oneoff", v:"oneoff"},
          {k:"need_mascot", v:"mascot"},
          {k:"need_unsure", v:"unsure"}
        ]
      },
      {
        id:"volume",
        titleKey:"q_volume",
        options:[
          {k:"vol_low", v:"low"},
          {k:"vol_mid", v:"mid"},
          {k:"vol_high", v:"high"},
          {k:"vol_mega", v:"mega"}
        ]
      },
      {
        id:"invest",
        titleKey:"q_invest",
        optional: true,
        options:[
          {k:"inv_skip", v:null},
          {k:"inv_100", v:100},
          {k:"inv_300", v:300},
          {k:"inv_600", v:600},
          {k:"inv_1000", v:1000},
          {k:"inv_2000", v:2000}
        ]
      },
      {
        id:"deadline",
        titleKey:"q_deadline",
        optional: true,
        options:[
          {k:"d1", v:"urgent"},
          {k:"d2", v:"week"},
          {k:"d3", v:"flex"}
        ]
      }
    ];

    function progressPct(){
      const total = steps.length + 2;
      return Math.round((stepIndex/total)*100);
    }

    function anchorByVolume(vol){
      if(vol==="low") return 300;
      if(vol==="mid") return 600;
      if(vol==="high") return 1000;
      return 2000;
    }
    function getAnchor(){
      const inv = answers.invest;
      if(typeof inv === "number" && isFinite(inv)) return inv;
      return anchorByVolume(answers.volume || "mid");
    }

    function findServiceByVenda(venda){
      return services.find(s => (s.titulo_venda||"") === venda);
    }

    function pickCoreByNeed(tier){
      const need = answers.need;
      const vol = answers.volume;

      const tierPick = (simpleVenda, valueVenda, advVenda)=> {
        if(tier==="simple") return findServiceByVenda(simpleVenda);
        if(tier==="value") return findServiceByVenda(valueVenda);
        return findServiceByVenda(advVenda);
      };

      if(need==="images"){
        if(vol==="high" || vol==="mega"){
          return tierPick("Pack Engajamento — 10 artes", "Pack Crescimento — 15 artes", "Pack Crescimento — 15 artes");
        }
        return tierPick("Pack Visual Rápido — 5 artes", "Pack Engajamento — 10 artes", "Pack Crescimento — 15 artes");
      }

      if(need==="videos"){
        if(vol==="mega") return tierPick("Vídeo Storytelling — até 30s", "Vídeo Premium — até 60s", "Vídeo Pro — até 120s (Efeitos especiais)");
        if(vol==="high") return tierPick("Vídeo Short — até 15s", "Vídeo Storytelling — até 30s", "Vídeo Premium — até 60s");
        return tierPick("Vídeo Short — até 15s", "Vídeo Storytelling — até 30s", "Vídeo Premium — até 60s");
      }

      if(need==="plan"){
        return tierPick("Plano Conteúdo Básico", "Plano Conteúdo Standart", "Plano Conteúdo Premium");
      }

      if(need==="mascot"){
        if((answers.goal==="launch" || vol==="mega")){
          return tierPick("Mascote Ilustrado — 5 poses", "Starter Pack — 1x 30s + 3 poses", "Brand Pack — 1x 1min + 3 poses");
        }
        return tierPick("Mascote Ilustrado — 5 poses", "Mascote Animado — 30s + narração", "Mascote Cinemático — 1 min + narração");
      }

      const g = answers.goal;
      if(g==="brand") return tierPick("Identidade Visual Básica — logomarca", "Website Corporativo Básico", "Website Corporativo Básico");
      if(g==="sales") return tierPick("Poster Promocional — Arte personalizada", "Shooting Compact — 10 fotos + 2 vídeos", "Shooting Compact — 10 fotos + 2 vídeos");
      if(g==="intl") return tierPick("Dublagem profissional por IA", "Dublagem profissional por IA", "Dublagem profissional por IA");
      if(g==="edu") return tierPick("Voz Profissional (IA) — por bloco", "Trilha Sonora Exclusiva por IA", "Trilha Sonora Exclusiva por IA");
      if(g==="launch") return tierPick("Poster Promocional — Arte personalizada", "Vídeo Storytelling — até 30s", "Vídeo Premium — até 60s");

      return tierPick("Poster Promocional — Arte personalizada", "Pack Engajamento — 10 artes", "Vídeo Premium — até 60s");
    }

    function uniquePush(arr, svc){
      if(!svc) return;
      if(arr.find(x=>x.__id===svc.__id)) return;
      arr.push(svc);
    }

    function suggestExtras(tier, core){
      const maxExtras = (tier==="simple") ? 1 : 2;
      const extras = [];

      const g = answers.goal;
      const vol = answers.volume;

      const add = (venda)=> uniquePush(extras, findServiceByVenda(venda));

      if(core && core.__cat==="Vídeos"){
        if(g==="sales" || g==="launch" || g==="social"){
          add(vol==="low" ? "Pack Visual Rápido — 5 artes" : "Pack Engajamento — 10 artes");
        }
      }
      if(core && core.__cat==="Imagens"){
        if(g==="sales" || g==="launch" || g==="social"){
          add("Vídeo Storytelling — até 30s");
        }
      }

      if(g==="sales" || g==="launch"){
        add("Poster Promocional — Arte personalizada");
        if(tier!=="simple") add("Shooting Compact — 10 fotos + 2 vídeos");
      }

      if(g==="brand"){
        add("Identidade Visual Básica — logomarca");
        if(tier!=="simple") add("Website Corporativo Básico");
        if(tier==="advanced") add("Mascote Ilustrado — 5 poses");
      }

      if(g==="edu"){
        add("Voz Profissional (IA) — por bloco");
        if(tier!=="simple") add("Trilha Sonora Exclusiva por IA");
      }

      if(g==="intl"){
        add("Dublagem profissional por IA");
      }

      if(answers.need==="plan"){
        if(g==="sales" || g==="launch") add("Poster Promocional — Arte personalizada");
        if(tier==="advanced") add("Vídeo Storytelling — até 30s");
      }

      const filtered = extras.filter(x=>!core || x.__id !== core.__id);
      return filtered.slice(0, maxExtras);
    }

    function calcOfferTotals(items, discountPerc, periodById){
      let subtotal = 0;
      let termTotal = 0;
      const lines = items.map(s=>{
        if(isPlan(s)){
          const period = periodById?.get(s.__id) || "Mensal";
          const p = getPlanPeriod(s, period);
          subtotal += p.monthly;
          termTotal += p.total;
          return {svc:s, kind:"plan", period:p.periodo, monthly:p.monthly, termTotal:p.total};
        } else {
          const price = Number(s.preco||0);
          subtotal += price;
          return {svc:s, kind:"oneoff", price};
        }
      });

      const discount = Math.round(subtotal * (discountPerc/100));
      const total = subtotal - discount;
      return {lines, subtotal, discount, total, termTotal};
    }

    function buildOffers(){
      const anchor = getAnchor();
      const discountSimple = 5;
      const discountValue = 10;
      const discountAdvanced = 12;

      const periodSimple = "Mensal";
      const periodValue = "Trimestral";
      const periodAdvanced = "Semestral";

      function buildTier(tier){
        const core = pickCoreByNeed(tier);
        const items = [];
        uniquePush(items, core);

        const extras = suggestExtras(tier, core);
        extras.forEach(x=>uniquePush(items, x));

        const periodById = new Map();
        items.forEach(s=>{
          if(isPlan(s)){
            periodById.set(s.__id, tier==="simple" ? periodSimple : tier==="value" ? periodValue : periodAdvanced);
          }
        });

        let discountPerc = (tier==="simple") ? discountSimple : (tier==="value") ? discountValue : discountAdvanced;
        if(tier==="simple" && items.length < 2) discountPerc = 0;

        const totals = calcOfferTotals(items, discountPerc, periodById);

        const target = tier==="simple" ? anchor*0.75 : tier==="value" ? anchor*1.0 : anchor*1.45;
        if(tier!=="simple" && totals.total > target*1.35 && items.length>1){
          items.pop();
          const totals2 = calcOfferTotals(items, discountPerc, periodById);
          return {tier, core, items, extrasSuggested: extras, periodById, discountPerc, ...totals2, anchor, target};
        }
        return {tier, core, items, extrasSuggested: extras, periodById, discountPerc, ...totals, anchor, target};
      }

      return [ buildTier("simple"), buildTier("value"), buildTier("advanced") ];
    }

    function labelGoal(){
      const map = {sales:"goal_sales", brand:"goal_brand", social:"goal_social", edu:"goal_edu", intl:"goal_intl", launch:"goal_launch"};
      return t(map[answers.goal]||"goal_social");
    }
    function labelNeed(){
      const map = {images:"need_images", videos:"need_videos", plan:"need_plan", oneoff:"need_oneoff", mascot:"need_mascot", unsure:"need_unsure"};
      return t(map[answers.need]||"need_unsure");
    }
    function labelVolume(){
      const map = {low:"vol_low", mid:"vol_mid", high:"vol_high", mega:"vol_mega"};
      return t(map[answers.volume]||"vol_mid");
    }
    function labelDeadline(){
      const map = {urgent:"d1", week:"d2", flex:"d3"};
      return t(map[answers.deadline]||"d3");
    }
    function labelInvest(){
      if(answers.invest==null) return t("inv_skip");
      const v = Number(answers.invest);
      if(v===100) return t("inv_100");
      if(v===300) return t("inv_300");
      if(v===600) return t("inv_600");
      if(v===1000) return t("inv_1000");
      if(v===2000) return t("inv_2000");
      return String(answers.invest);
    }

    function renderStep(i){
      stepIndex = i;
      if(i >= steps.length) return renderOffers();

      const s = steps[i];
      const pct = progressPct();

      const opts = s.options.map(o=>{
        const isSkip = (o.v===null && s.id==="invest");
        return `
          <button class="option ring-brand text-left p-4 sm:p-5 w-full" data-value="${o.v===null ? "null" : escapeHtml(o.v)}">
            <div class="flex items-start gap-3">
              <div class="badge w-10 h-10 flex items-center justify-center">
                <svg class="i brand" viewBox="0 0 24 24" fill="none">
                  <path d="${isSkip ? "M6 12h12 M12 6v12" : "M7 12h10 M12 7v10"}" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                </svg>
              </div>
              <div class="min-w-0">
                <div class="font-display font-extrabold leading-snug" style="color: var(--text);">${escapeHtml(t(o.k))}</div>
                ${isSkip ? `<div class="text-sm muted mt-1">${escapeHtml(lang==="en" ? "We’ll estimate based on volume." : "Vamos estimar pelo volume.")}</div>` : ``}
              </div>
            </div>
          </button>
        `;
      }).join("");

      setFade(`
        <div class="fade">
          <div class="card p-5 sm:p-6">
            <div class="flex items-start justify-between gap-4">
              <div>
                <div class="text-xs font-bold" style="color: rgba(11,95,255,1);">
                  ${escapeHtml(t("step"))} ${i+1} ${escapeHtml(t("of"))} ${steps.length}
                </div>
                <div class="font-display text-xl sm:text-2xl font-extrabold mt-1 tracking-tight" style="color: var(--text);">
                  ${escapeHtml(t(s.titleKey))}
                </div>
              </div>

              <div class="min-w-[150px]">
                <div class="text-xs muted text-right">${pct}%</div>
                <div class="h-2 rounded-full overflow-hidden" style="background: rgba(11,95,255,.10);">
                  <div class="h-2" style="width:${pct}%; background: linear-gradient(90deg, rgba(11,95,255,1), rgba(46,123,255,1));"></div>
                </div>
              </div>
            </div>

            <div class="mt-5 grid gap-3 sm:gap-4 sm:grid-cols-2">
              ${opts}
            </div>

            <div class="mt-5 flex items-center justify-between gap-3">
              <button id="backBtn" class="btn ring-brand px-4 py-2.5 font-display font-bold border ${i===0 ? "opacity-40 cursor-not-allowed" : ""}" ${i===0 ? "disabled":""}
                style="border-color: rgba(11,95,255,.18); background: rgba(255,255,255,.55); color: rgba(11,95,255,1);">
                ${escapeHtml(t("back"))}
              </button>

              <div class="text-xs muted">
                Comerc IAs • ${escapeHtml(lang==="en" ? "Premium quote" : "Orçamento premium")}
              </div>
            </div>
          </div>
        </div>
      `);

      $("backBtn").addEventListener("click", ()=>renderStep(Math.max(0, i-1)));

      app.querySelectorAll("[data-value]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const raw = btn.getAttribute("data-value");
          let v = raw;
          if(raw === "null") v = null;
          else v = isNaN(Number(raw)) ? raw : Number(raw);
          answers[s.id] = v;
          renderStep(i+1);
        });
      });
    }

    function offerLabel(tier){
      if(tier==="simple") return t("offer_simple");
      if(tier==="value") return t("offer_value");
      return t("offer_advanced");
    }
    function offerBestBadge(tier){
      if(tier==="value"){
        return `<span class="badge px-3 py-1 text-[11px] font-extrabold" style="color: rgba(11,95,255,1);">${escapeHtml(t("offer_best"))}</span>`;
      }
      return "";
    }
    function offerBullets(offer){
      const items = offer.lines;
      const a = items[0] ? svcTitle(items[0].svc) : "";
      const b = items[1] ? svcTitle(items[1].svc) : "";
      const c = items[2] ? svcTitle(items[2].svc) : "";
      const out = [a,b,c].filter(Boolean).slice(0,3);
      return out.map(x=>`<li class="text-sm muted">${escapeHtml(x)}</li>`).join("");
    }

    function renderOffers(){
      stepIndex = steps.length;
      const offers = buildOffers();

      const summaryHtml = `
        <div class="badge p-4">
          <div class="text-xs muted">${escapeHtml(t("summary"))}</div>
          <div class="mt-2 text-sm">
            <div><span class="font-semibold" style="color: var(--text);">${escapeHtml(t("q_goal"))}</span> <span class="muted">${escapeHtml(labelGoal())}</span></div>
            <div><span class="font-semibold" style="color: var(--text);">${escapeHtml(t("q_need"))}</span> <span class="muted">${escapeHtml(labelNeed())}</span></div>
            <div><span class="font-semibold" style="color: var(--text);">${escapeHtml(t("q_volume"))}</span> <span class="muted">${escapeHtml(labelVolume())}</span></div>
            <div><span class="font-semibold" style="color: var(--text);">${escapeHtml(t("q_invest"))}</span> <span class="muted">${escapeHtml(labelInvest())}</span></div>
            <div><span class="font-semibold" style="color: var(--text);">${escapeHtml(t("q_deadline"))}</span> <span class="muted">${escapeHtml(labelDeadline())}</span></div>
          </div>
        </div>
      `;

      const cards = offers.map(of=>{
        const save = of.discount;
        const highlight = (of.tier==="value");
        const cardClass = highlight ? "card offer-feature p-5 sm:p-6" : "card p-5 sm:p-6";
        const priceLabel = money(of.total);

        return `
          <div class="${cardClass}" style="${highlight ? "border-color: rgba(11,95,255,.32);" : ""}">
            <div class="flex items-start justify-between gap-3">
              <div>
                <div class="flex items-center gap-2">
                  <div class="font-display font-extrabold" style="color: var(--text);">${escapeHtml(offerLabel(of.tier))}</div>
                  ${offerBestBadge(of.tier)}
                </div>
                <div class="text-sm muted mt-1">${escapeHtml(t("est_total"))}</div>
              </div>

              <div class="text-right">
                <div class="font-display text-3xl font-extrabold tracking-tight" style="color: rgba(11,95,255,1);">${escapeHtml(priceLabel)}</div>
                ${save ? `<div class="text-xs muted mt-1">${escapeHtml(t("you_save"))}: <span class="font-semibold" style="color: var(--text);">${escapeHtml(money(save))}</span></div>` : `<div class="text-xs muted mt-1">&nbsp;</div>`}
              </div>
            </div>

            <ul class="mt-4 space-y-2">
              ${offerBullets(of)}
            </ul>

            <details class="mt-4">
              <summary class="cursor-pointer select-none text-sm font-bold flex items-center justify-between" style="color: rgba(11,95,255,1);">
                <span>${escapeHtml(t("offer_details"))}</span>
                <svg class="chev i brand" viewBox="0 0 24 24" fill="none"><path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
              </summary>

              <div class="mt-3 badge p-4">
                <div class="text-sm font-semibold" style="color: var(--text);">${escapeHtml(lang==="en" ? "Included items:" : "Itens inclusos:")}</div>
                <ul class="mt-2 text-sm muted list-disc pl-5">
                  ${of.lines.map(x=>{
                    if(x.kind==="plan"){
                      return `<li>${escapeHtml(svcTitle(x.svc))} — ${escapeHtml(money(x.monthly))}${escapeHtml(t("per_month"))} (${escapeHtml(x.period)})</li>`;
                    }
                    return `<li>${escapeHtml(svcTitle(x.svc))} — ${escapeHtml(money(x.price))}</li>`;
                  }).join("")}
                </ul>
              </div>
            </details>

            <button class="mt-5 btn ${highlight ? "btn-primary text-white" : ""} ring-brand w-full px-5 py-3 font-display font-extrabold"
              style="${highlight ? "" : "border: 1px solid rgba(11,95,255,.18); background: rgba(255,255,255,.55); color: rgba(11,95,255,1);"}"
              data-pick="${escapeHtml(of.tier)}">
              ${escapeHtml(t("offer_pick"))}
            </button>
          </div>
        `;
      }).join("");

      setFade(`
        <div class="fade">
          <div class="card p-5 sm:p-6">
            <div class="flex items-start justify-between gap-4">
              <div>
                <div class="text-xs font-bold" style="color: rgba(11,95,255,1);">${escapeHtml(t("done"))}</div>
                <div class="font-display text-xl sm:text-2xl font-extrabold mt-1 tracking-tight" style="color: var(--text);">${escapeHtml(t("offers_title"))}</div>
                <div class="text-sm muted mt-1">${escapeHtml(t("offers_sub"))}</div>
              </div>
              <div class="min-w-[150px]">
                <div class="text-xs muted text-right">~${progressPct()}%</div>
                <div class="h-2 rounded-full overflow-hidden" style="background: rgba(11,95,255,.10);">
                  <div class="h-2" style="width:${Math.min(95, progressPct())}%; background: linear-gradient(90deg, rgba(11,95,255,1), rgba(46,123,255,1));"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-4 grid lg:grid-cols-5 gap-4">
            <div class="lg:col-span-2 space-y-4 lg:sticky lg:top-6 h-fit">
              ${summaryHtml}
              <div class="text-xs muted">
                <span class="font-semibold" style="color: var(--text);">${escapeHtml(t("obs"))}:</span> ${escapeHtml(OBS)}
              </div>
              <div class="flex gap-2">
                <button id="backToQuiz" class="btn ring-brand px-4 py-2.5 font-display font-bold border"
                  style="border-color: rgba(11,95,255,.18); background: rgba(255,255,255,.55); color: rgba(11,95,255,1);">${escapeHtml(t("back"))}</button>
                <button id="resetBtn" class="btn ring-brand px-4 py-2.5 font-display font-bold border"
                  style="border-color: rgba(11,95,255,.18); background: rgba(255,255,255,.55); color: rgba(11,95,255,1);">${escapeHtml(t("restart"))}</button>
              </div>
            </div>

            <div class="lg:col-span-3">
              <div class="grid gap-3 sm:gap-4 sm:grid-cols-2 lg:grid-cols-3">
                ${cards}
              </div>
            </div>
          </div>
        </div>
      `);

      $("backToQuiz").addEventListener("click", ()=>renderStep(Math.max(0, steps.length-1)));
      $("resetBtn").addEventListener("click", resetAll);

      app.querySelectorAll("[data-pick]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const tier = btn.getAttribute("data-pick");
          const offersNow = buildOffers();
          const picked = offersNow.find(o=>o.tier===tier) || offersNow[1];
          chosenOffer = picked;
          initCustomizeState(picked);
          renderCustomize();
        });
      });
    }

    function initCustomizeState(offer){
      const selectedIds = new Set(offer.items.map(s=>s.__id));
      const extraIds = new Set();
      const periodById = new Map();
      offer.items.forEach(s=>{
        if(isPlan(s)){
          periodById.set(s.__id, offer.periodById.get(s.__id) || "Mensal");
        }
      });
      customState = {selectedIds, extraIds, periodById};
    }

    function suggestedExtrasForCustomize(){
      const pool = [];
      const add = (venda)=>{
        const svc = findServiceByVenda(venda);
        if(!svc) return;
        if(customState.selectedIds.has(svc.__id)) return;
        if(pool.find(x=>x.__id===svc.__id)) return;
        pool.push(svc);
      };

      const g = answers.goal;
      const need = answers.need;

      if(g==="sales" || g==="launch"){
        add("Poster Promocional — Arte personalizada");
        add("Shooting Compact — 10 fotos + 2 vídeos");
        add("Vídeo Premium — até 60s");
        add("Pack Engajamento — 10 artes");
      }
      if(g==="brand"){
        add("Identidade Visual Básica — logomarca");
        add("Website Corporativo Básico");
        add("Mascote Ilustrado — 5 poses");
      }
      if(g==="edu"){
        add("Voz Profissional (IA) — por bloco");
        add("Trilha Sonora Exclusiva por IA");
      }
      if(g==="intl"){
        add("Dublagem profissional por IA");
      }
      if(need==="plan"){
        add("Vídeo Storytelling — até 30s");
        add("Poster Promocional — Arte personalizada");
      }
      if(need==="videos"){
        add("Pack Visual Rápido — 5 artes");
        add("Pack Engajamento — 10 artes");
      }
      if(need==="images"){
        add("Vídeo Storytelling — até 30s");
      }
      if(need==="mascot"){
        add("Starter Pack — 1x 30s + 3 poses");
        add("Brand Pack — 1x 1min + 3 poses");
      }

      return pool.slice(0,6);
    }

    function computeCustomizeTotals(){
      const items = [];
      customState.selectedIds.forEach(id=>{
        const s = services.find(x=>x.__id===id);
        if(s) items.push(s);
      });
      customState.extraIds.forEach(id=>{
        const s = services.find(x=>x.__id===id);
        if(s) items.push(s);
      });

      const discountPerc = chosenOffer.discountPerc || 0;
      return calcOfferTotals(items, discountPerc, customState.periodById);
    }

    function buildWhatsAppMessage(note){
      const totals = computeCustomizeTotals();
      const offerName = offerLabel(chosenOffer.tier);

      const included = [];
      const extras = [];

      totals.lines.forEach(x=>{
        const id = x.svc.__id;
        const lineText = (x.kind==="plan")
          ? `${svcTitle(x.svc)} — ${money(x.monthly)}${t("per_month")} (${x.period})`
          : `${svcTitle(x.svc)} — ${money(x.price)}`;

        if(chosenOffer.items.find(s=>s.__id===id)) included.push(lineText);
        else extras.push(lineText);
      });

      const lines = [];
      lines.push(t("wa_intro"));
      lines.push("");
      lines.push(`${t("wa_offer")} ${offerName}`);
      lines.push("");
      lines.push(t("wa_answers"));
      lines.push(`- ${t("q_goal")} ${labelGoal()}`);
      lines.push(`- ${t("q_need")} ${labelNeed()}`);
      lines.push(`- ${t("q_volume")} ${labelVolume()}`);
      lines.push(`- ${t("q_invest")} ${labelInvest()}`);
      lines.push(`- ${t("q_deadline")} ${labelDeadline()}`);
      lines.push("");

      lines.push(t("wa_services"));
      included.forEach(x=>lines.push(`- ${x}`));

      if(extras.length){
        lines.push("");
        lines.push(t("wa_extras"));
        extras.forEach(x=>lines.push(`- ${x}`));
      }

      lines.push("");
      lines.push(`${t("wa_total")} ${money(totals.total)}`);
      if(totals.discount){
        lines.push(`${lang==="en" ? "Discount" : "Desconto"}: -${money(totals.discount)} (${chosenOffer.discountPerc}%)`);
      }
      if(totals.termTotal){
        lines.push(`${t("plan_total")}: ${money(totals.termTotal)}`);
      }

      if(note && note.trim()){
        lines.push("");
        lines.push(t("wa_note"));
        lines.push(note.trim());
      }

      lines.push("");
      lines.push(lang==="en" ? "Can you confirm availability and next steps?" : "Pode me confirmar disponibilidade e próximos passos?");
      return lines.join("\n");
    }

    function openWhatsApp(){
      const note = document.getElementById("noteField")?.value || "";
      const msg = buildWhatsAppMessage(note);
      window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`, "_blank");
    }

    function openBudget(){
      const note = document.getElementById("noteField")?.value || "";
      const totals = computeCustomizeTotals();

      const payload = totals.lines.map(it=>{
        if(it.kind==="plan"){
          return {category: it.svc.__cat, title: it.svc.titulo_venda||it.svc.titulo, period: it.period, monthly: it.monthly, termTotal: it.termTotal};
        }
        return {category: it.svc.__cat, title: it.svc.titulo_venda||it.svc.titulo, price: it.price};
      });

      const base = (lang==="en") ? "https://www.comercias.com.br/en/orcamento" : "https://www.comercias.com.br/pt/orcamento";
      const resumo = buildWhatsAppMessage(note);
      const url = `${base}?servicos=${encodeURIComponent(JSON.stringify(payload))}&resumo=${encodeURIComponent(resumo)}&total=${encodeURIComponent(String(totals.total))}&lang=${lang}`;
      window.open(url, "_blank");
    }

    function renderCustomize(){
      stepIndex = steps.length + 1;

      const extras = suggestedExtrasForCustomize();
      const totals = computeCustomizeTotals();

      function priceLine(s){
        if(isPlan(s)){
          const period = customState.periodById.get(s.__id) || "Mensal";
          const p = getPlanPeriod(s, period);
          return `${money(p.monthly)}${t("per_month")} (${p.periodo})`;
        }
        return money(s.preco);
      }

      function serviceItem(s, kind){
        const checked = (kind==="included") ? customState.selectedIds.has(s.__id) : customState.extraIds.has(s.__id);
        const disabled = (kind==="included");
        const showPeriod = isPlan(s);

        return `
          <label class="card p-4 flex items-start gap-3">
            <input type="checkbox"
              class="mt-1 w-5 h-5 accent-[rgba(11,95,255,1)]"
              data-sid="${escapeHtml(s.__id)}"
              data-kind="${escapeHtml(kind)}"
              ${checked ? "checked" : ""}
              ${disabled ? "disabled" : ""}/>
            <div class="flex-1 min-w-0">
              <div class="flex items-start justify-between gap-3">
                <div class="min-w-0">
                  <div class="font-display font-extrabold" style="color: var(--text);">${escapeHtml(svcTitle(s))}</div>
                  <div class="text-sm muted mt-1">${escapeHtml(s.descricao||"")}</div>
                  <div class="mt-2 flex flex-wrap gap-2">
                    <span class="badge px-3 py-1 text-xs font-bold" style="color: rgba(11,95,255,1);">${escapeHtml(catName(s.__cat))}</span>
                    <span class="badge px-3 py-1 text-xs muted">${escapeHtml(s.prazo_entrega||"-")}</span>
                  </div>
                </div>
                <div class="text-right shrink-0">
                  <div class="font-display font-extrabold" style="color: rgba(11,95,255,1);">${escapeHtml(priceLine(s))}</div>
                </div>
              </div>

              ${showPeriod ? `
                <div class="mt-3">
                  <div class="text-xs font-bold muted">${escapeHtml(t("period"))}</div>
                  <select class="periodSel ring-brand mt-1 w-full rounded-2xl border px-4 py-2.5 text-sm"
                    style="border-color: rgba(11,95,255,.18); background: rgba(255,255,255,.55); color: var(--text);"
                    data-sid="${escapeHtml(s.__id)}">
                    ${(s.precos_por_periodo||[]).map(p=>{
                      const label = `${p.periodo} • ${money(p.preco_mensal_efetivo)}${t("per_month")}`;
                      return `<option value="${escapeHtml(p.periodo)}" ${p.periodo=== (customState.periodById.get(s.__id)||"Mensal") ? "selected":""}>${escapeHtml(label)}</option>`;
                    }).join("")}
                  </select>
                  <div class="text-xs muted mt-1">${escapeHtml(t("plan_total"))}: ${escapeHtml(money(getPlanPeriod(s, customState.periodById.get(s.__id)||"Mensal").total))}</div>
                </div>
              ` : ``}
            </div>
          </label>
        `;
      }

      const includedList = chosenOffer.items.map(s=>serviceItem(s, "included")).join("");
      const extrasList = extras.length ? extras.map(s=>serviceItem(s, "extra")).join("") : `
        <div class="badge p-4 text-sm muted">${escapeHtml(lang==="en" ? "No add-ons suggested for this selection." : "Sem extras sugeridos para esta seleção.")}</div>
      `;

      const save = totals.discount ? `${t("you_save")}: ${money(totals.discount)}` : (lang==="en" ? "No bundle discount" : "Sem desconto de combo");
      const offerName = offerLabel(chosenOffer.tier);

      setFade(`
        <div class="fade">
          <div class="card p-5 sm:p-6">
            <div class="flex items-start justify-between gap-4">
              <div>
                <div class="text-xs font-bold" style="color: rgba(11,95,255,1);">${escapeHtml(offerName)}</div>
                <div class="font-display text-xl sm:text-2xl font-extrabold mt-1 tracking-tight" style="color: var(--text);">${escapeHtml(t("customize_title"))}</div>
                <div class="text-sm muted mt-1">${escapeHtml(t("customize_sub"))}</div>
              </div>
              <div class="min-w-[170px] text-right">
                <div class="text-xs muted">${escapeHtml(t("est_total"))}</div>
                <div class="font-display text-3xl font-extrabold tracking-tight" style="color: rgba(11,95,255,1);">${escapeHtml(money(totals.total))}</div>
                <div class="text-xs muted mt-1">${escapeHtml(save)}</div>
              </div>
            </div>
          </div>

          <div class="mt-4 grid lg:grid-cols-5 gap-4">
            <div class="lg:col-span-2 space-y-4 lg:sticky lg:top-6 h-fit">
              <div class="card p-5">
                <div class="font-display font-extrabold" style="color: var(--text);">${escapeHtml(t("summary"))}</div>
                <div class="mt-3 text-sm">
                  <div><span class="font-semibold" style="color: var(--text);">${escapeHtml(t("q_goal"))}</span> <span class="muted">${escapeHtml(labelGoal())}</span></div>
                  <div><span class="font-semibold" style="color: var(--text);">${escapeHtml(t("q_need"))}</span> <span class="muted">${escapeHtml(labelNeed())}</span></div>
                  <div><span class="font-semibold" style="color: var(--text);">${escapeHtml(t("q_volume"))}</span> <span class="muted">${escapeHtml(labelVolume())}</span></div>
                  <div><span class="font-semibold" style="color: var(--text);">${escapeHtml(t("q_invest"))}</span> <span class="muted">${escapeHtml(labelInvest())}</span></div>
                  <div><span class="font-semibold" style="color: var(--text);">${escapeHtml(t("q_deadline"))}</span> <span class="muted">${escapeHtml(labelDeadline())}</span></div>
                </div>
              </div>

              <div class="card p-5">
                <div class="font-display font-extrabold" style="color: var(--text);">${escapeHtml(t("note_hint"))}</div>
                <textarea id="noteField" class="ring-brand mt-2 w-full rounded-2xl border px-4 py-3 text-sm min-h-[110px]"
                  style="border-color: rgba(11,95,255,.18); background: rgba(255,255,255,.55); color: var(--text);"
                  placeholder="${escapeHtml(lang==="en" ? "Example: I need content for a campaign next week…" : "Ex.: preciso de conteúdo para uma campanha na próxima semana…")}"></textarea>
              </div>

              <div class="grid sm:grid-cols-2 gap-2">
                <button id="sendWA" class="btn btn-primary ring-brand text-white px-5 py-3 font-display font-extrabold w-full">${escapeHtml(t("send_whatsapp"))}</button>
                <button id="openBudget" class="btn ring-brand px-5 py-3 font-display font-bold w-full border"
                  style="border-color: rgba(11,95,255,.18); background: rgba(255,255,255,.55); color: rgba(11,95,255,1);">${escapeHtml(t("open_budget"))}</button>
              </div>

              <div class="text-xs muted">
                <span class="font-semibold" style="color: var(--text);">${escapeHtml(t("obs"))}:</span> ${escapeHtml(OBS)}
              </div>

              <div class="flex gap-2">
                <button id="backToOffers" class="btn ring-brand px-4 py-2.5 font-display font-bold border"
                  style="border-color: rgba(11,95,255,.18); background: rgba(255,255,255,.55); color: rgba(11,95,255,1);">${escapeHtml(lang==="en" ? "Back to offers" : "Voltar às ofertas")}</button>
                <button id="resetBtn" class="btn ring-brand px-4 py-2.5 font-display font-bold border"
                  style="border-color: rgba(11,95,255,.18); background: rgba(255,255,255,.55); color: rgba(11,95,255,1);">${escapeHtml(t("restart"))}</button>
              </div>
            </div>

            <div class="lg:col-span-3 space-y-4">
              <div class="card p-5">
                <div class="font-display font-extrabold" style="color: var(--text);">${escapeHtml(t("included"))}</div>
                <div class="mt-3 grid gap-3">
                  ${includedList}
                </div>
              </div>

              <div class="card p-5">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <div class="font-display font-extrabold" style="color: var(--text);">${escapeHtml(t("extras"))}</div>
                    <div class="text-sm muted mt-1">${escapeHtml(t("extras_hint"))}</div>
                  </div>
                  <span class="badge px-3 py-1 text-xs font-bold" style="color: rgba(11,95,255,1);">${escapeHtml(lang==="en" ? "Optional" : "Opcional")}</span>
                </div>
                <div class="mt-3 grid gap-3">
                  ${extrasList}
                </div>
              </div>
            </div>
          </div>
        </div>
      `);

      document.getElementById("sendWA").addEventListener("click", openWhatsApp);
      document.getElementById("openBudget").addEventListener("click", openBudget);
      document.getElementById("backToOffers").addEventListener("click", renderOffers);
      document.getElementById("resetBtn").addEventListener("click", resetAll);

      app.querySelectorAll('input[type="checkbox"][data-kind="extra"]').forEach(ch=>{
        ch.addEventListener("change", ()=>{
          const id = ch.getAttribute("data-sid");
          if(ch.checked) customState.extraIds.add(id);
          else customState.extraIds.delete(id);
          renderCustomize();
        });
      });

      app.querySelectorAll(".periodSel").forEach(sel=>{
        sel.addEventListener("change", ()=>{
          const id = sel.getAttribute("data-sid");
          customState.periodById.set(id, sel.value);
          renderCustomize();
        });
      });
    }

    function resetAll(){
      answers = {};
      stepIndex = 0;
      chosenOffer = null;
      customState = null;
      renderIntro();
    }

    function renderIntro(){
      setFade(`
        <div class="fade">
          <div class="card p-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
              <div>
                <div class="badge inline-flex items-center gap-2 px-3 py-1.5 text-xs font-bold tracking-wide" style="color: rgba(11,95,255,1);">
                  <svg class="i brand" viewBox="0 0 24 24" fill="none"><path d="M12 2l8.5 4.9v10.2L12 22l-8.5-4.9V6.9L12 2z" stroke="currentColor" stroke-width="1.6"/></svg>
                  <span>${escapeHtml(lang==="en" ? "READY" : "PRONTO")}</span>
                </div>
                <div class="font-display text-2xl font-extrabold mt-3 tracking-tight" style="color: var(--text);">
                  ${escapeHtml(lang==="en" ? "Let’s find the best offer" : "Vamos encontrar a melhor oferta")}
                </div>
                <div class="muted mt-2">
                  ${escapeHtml(lang==="en"
                    ? "Answer a quick quiz, pick one of 3 clear offers, and finish via WhatsApp or the quote page."
                    : "Responda um quiz rápido, escolha 1 das 3 ofertas e finalize via WhatsApp ou página de orçamento."
                  )}
                </div>
              </div>

              <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <button id="startInline" class="btn btn-primary ring-brand text-white px-5 py-3 font-display font-extrabold w-full sm:w-auto">${escapeHtml(t("start"))}</button>
                <button id="resetInline" class="btn ring-brand px-5 py-3 font-display font-bold border w-full sm:w-auto"
                  style="border-color: rgba(11,95,255,.18); background: rgba(255,255,255,.55); color: rgba(11,95,255,1);">${escapeHtml(t("restart"))}</button>
              </div>
            </div>
          </div>
        </div>
      `);

      document.getElementById("startInline").addEventListener("click", ()=>renderStep(0));
      document.getElementById("resetInline").addEventListener("click", resetAll);
    }

    // ---------- Language + Theme UI ----------
    function applyLangUI(){
      document.documentElement.lang = (lang==="en") ? "en" : "pt-BR";

      $("brandSub").textContent = t("brandSub");
      $("footerLeft").textContent = t("footerLeft");
      $("footerRight").textContent = t("footerRight");
      $("heroBadge").textContent = t("heroBadge");
      $("heroTitle").textContent = t("heroTitle");
      $("heroSubtitle").textContent = t("heroSubtitle");
      $("heroNote").textContent = t("heroNote");

      $("kpi1d").textContent = t("kpi1d");
      $("kpi2d").textContent = t("kpi2d");
      $("kpi3d").textContent = t("kpi3d");

      $("startBtn").textContent = t("start");
      $("resetBtnTop").textContent = t("restart");

      // Floating labels
      const siteLabel = document.getElementById("siteLabel");
      const igLabel = document.getElementById("igLabel");
      if(siteLabel) siteLabel.textContent = t("link_site");
      if(igLabel) igLabel.textContent = t("link_ig");

      updateThemeButton();

      const theme = root.getAttribute("data-theme") || "light";
      const isDark = theme === "dark";

      if(lang==="pt"){
        $("langPT").style.background = "linear-gradient(180deg, rgba(11,95,255,1), rgba(10,72,190,1))";
        $("langPT").style.color = "#fff";
        $("langEN").style.background = "transparent";
        $("langEN").style.color = "rgba(11,95,255,1)";
      }else{
        $("langEN").style.background = "linear-gradient(180deg, rgba(11,95,255,1), rgba(10,72,190,1))";
        $("langEN").style.color = "#fff";
        $("langPT").style.background = "transparent";
        $("langPT").style.color = "rgba(11,95,255,1)";
      }

      // Small polish: in dark mode, reduce light hover backgrounds
      const resetTop = $("resetBtnTop");
      if(resetTop){
        resetTop.style.background = isDark ? "rgba(4,20,47,.70)" : "rgba(255,255,255,.55)";
        resetTop.style.borderColor = isDark ? "rgba(234,242,255,.12)" : "rgba(11,95,255,.18)";
        resetTop.style.color = isDark ? "rgba(234,242,255,.92)" : "rgba(11,95,255,1)";
      }
    }

    $("langPT").addEventListener("click", ()=>{
      lang = "pt";
      applyLangUI();
      if(customState && chosenOffer) renderCustomize();
      else if(stepIndex >= steps.length) renderOffers();
      else if(stepIndex > 0) renderStep(stepIndex);
      else renderIntro();
    });

    $("langEN").addEventListener("click", ()=>{
      lang = "en";
      applyLangUI();
      if(customState && chosenOffer) renderCustomize();
      else if(stepIndex >= steps.length) renderOffers();
      else if(stepIndex > 0) renderStep(stepIndex);
      else renderIntro();
    });

    $("startBtn").addEventListener("click", ()=>{
      renderStep(0);
      app.scrollIntoView({behavior:"smooth", block:"start"});
    });

    $("resetBtnTop").addEventListener("click", resetAll);

    // Theme button (floating, always visible)
    document.getElementById("themeBtn").addEventListener("click", toggleTheme);

    // init theme
    const saved = getSavedTheme();
    const initialTheme = saved || (prefersDark() ? "dark" : "light");
    root.setAttribute("data-theme", initialTheme);

    // init UI + first screen
    applyLangUI();
    renderIntro();

  })();
  </script>
</body>
</html>
