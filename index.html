<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Comercias â€¢ Service Finder</title>

  <!-- Premium font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Plus Jakarta Sans', 'ui-sans-serif', 'system-ui'] },
          boxShadow: {
            premium: '0 18px 60px rgba(0,0,0,.35)',
            soft: '0 10px 30px rgba(2,6,23,.18)',
            insetSoft: 'inset 0 1px 0 rgba(255,255,255,.08)'
          }
        }
      }
    }
  </script>

  <style>
    body{
      background:
        radial-gradient(1200px 680px at 15% 10%, rgba(99,102,241,.25), transparent 55%),
        radial-gradient(900px 540px at 85% 20%, rgba(14,165,233,.20), transparent 55%),
        radial-gradient(900px 540px at 50% 90%, rgba(168,85,247,.14), transparent 60%),
        linear-gradient(180deg, rgba(2,6,23,1), rgba(2,6,23,.95));
    }
    .dots{
      background-image: radial-gradient(rgba(255,255,255,.08) 1px, transparent 1px);
      background-size: 18px 18px;
      mask-image: radial-gradient(circle at 30% 20%, black 0%, transparent 60%);
      opacity: .55;
      pointer-events:none;
    }
    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow: 0 18px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.08);
    }
    .fade { opacity: 0; transform: translateY(10px); transition: all .24s ease; }
    .fade.show { opacity: 1; transform: translateY(0); }
    .panel-enter { opacity: 0; transform: translateY(10px) scale(.985); transition: all .18s ease; }
    .panel-enter.show { opacity: 1; transform: translateY(0) scale(1); }
    .ring-focus:focus { outline: none; box-shadow: 0 0 0 5px rgba(99,102,241,.25); }

    .grad-border{ position: relative; border-radius: 22px; overflow: hidden; }
    .grad-border:before{
      content:"";
      position:absolute; inset:0;
      padding: 1px;
      border-radius: 22px;
      background: linear-gradient(135deg, rgba(99,102,241,.9), rgba(14,165,233,.85), rgba(168,85,247,.70));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events:none;
      opacity: .55;
    }

    .btn-primary{
      background: linear-gradient(90deg, rgba(99,102,241,1), rgba(14,165,233,1));
      box-shadow: 0 18px 45px rgba(99,102,241,.22);
    }
    .btn-primary:hover{ filter: brightness(1.05); }
    .btn-ghost{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
    }
    .btn-ghost:hover{ background: rgba(255,255,255,.10); }

    .opt{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }
    .opt:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.10);
      border-color: rgba(255,255,255,.22);
    }

    @media (max-width: 767px){
      #modalPanel{
        align-self: flex-end;
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
        max-height: 92vh;
      }
    }
  </style>
</head>

<body class="min-h-screen font-sans text-white">
  <div class="fixed inset-0 dots"></div>

  <main class="relative min-h-screen flex items-center justify-center px-4 py-10">
    <div class="w-full max-w-6xl">
      <div class="flex items-center justify-between mb-6 md:mb-8">
        <div class="flex items-center gap-3">
          <div class="h-10 w-10 rounded-2xl bg-white/10 border border-white/12 flex items-center justify-center">
            <span class="text-lg">âœ¦</span>
          </div>
          <div>
            <div class="text-sm text-white/60">Comercias â€¢ Smart Quote</div>
            <div class="text-lg font-extrabold tracking-tight">Service Finder</div>
          </div>
        </div>

        <div class="inline-flex items-center gap-1 p-1 rounded-2xl btn-ghost">
          <button id="langPTTop" class="ring-focus px-3 py-2 rounded-xl text-sm font-semibold bg-white/10">ðŸ‡§ðŸ‡· PT</button>
          <button id="langENTop" class="ring-focus px-3 py-2 rounded-xl text-sm font-semibold text-white/70">ðŸ‡ºðŸ‡¸ EN</button>
        </div>
      </div>

      <section class="glass rounded-[28px] overflow-hidden">
        <div class="p-6 md:p-10 grid lg:grid-cols-[1.1fr_.9fr] gap-8">
          <div>
            <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/8 border border-white/12 text-xs text-white/70">
              <span class="inline-block h-2 w-2 rounded-full bg-emerald-400"></span>
              <span id="heroBadge">Quiz inteligente â€¢ Combos â€¢ SimulaÃ§Ã£o de desconto</span>
            </div>

            <h1 id="heroTitle" class="mt-4 text-3xl md:text-5xl font-extrabold tracking-tight leading-[1.05]">
              Encontre o serviÃ§o ideal em minutos.
            </h1>
            <p id="heroSub" class="mt-4 text-white/70 text-base md:text-lg max-w-2xl">
              Responda em ~2 minutos. No final, selecione os serviÃ§os e vÃ¡ para o orÃ§amento jÃ¡ preenchido.
            </p>

            <div class="mt-6 flex flex-col sm:flex-row gap-3">
              <button id="openModal" class="ring-focus btn-primary px-6 py-3.5 rounded-2xl font-bold inline-flex items-center justify-center gap-2">
                <span id="ctaStart">ComeÃ§ar quiz</span>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="opacity-90">
                  <path d="M8 5l8 7-8 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>

              <div class="rounded-2xl btn-ghost px-4 py-3 text-sm text-white/70 leading-snug">
                <div class="font-semibold text-white/85" id="miniNoteTitle">Dica rÃ¡pida</div>
                <div id="miniNoteText">
                  Sem arquivo externo: os serviÃ§os jÃ¡ estÃ£o embutidos no HTML.
                </div>
              </div>
            </div>

            <div class="mt-6 grid sm:grid-cols-3 gap-3">
              <div class="rounded-2xl btn-ghost p-4">
                <div class="font-semibold" id="b1t">RecomendaÃ§Ã£o automÃ¡tica</div>
                <div class="text-white/65 text-sm mt-1" id="b1s">Sugere serviÃ§os e pacotes com base no objetivo.</div>
              </div>
              <div class="rounded-2xl btn-ghost p-4">
                <div class="font-semibold" id="b2t">Upsell inteligente</div>
                <div class="text-white/65 text-sm mt-1" id="b2s">Planos e add-ons aparecem sÃ³ quando fazem sentido.</div>
              </div>
              <div class="rounded-2xl btn-ghost p-4">
                <div class="font-semibold" id="b3t">Finaliza com 1 clique</div>
                <div class="text-white/65 text-sm mt-1" id="b3s">Direciona para o orÃ§amento com tudo preenchido.</div>
              </div>
            </div>
          </div>

          <div class="grad-border">
            <div class="rounded-[22px] bg-black/25 border border-white/10 p-5 md:p-6">
              <div class="flex items-center justify-between mb-4">
                <div class="text-sm text-white/70" id="previewTitle">Como funciona</div>
                <div class="text-xs text-white/55" id="previewTime">~2 min</div>
              </div>

              <div class="space-y-3">
                <div class="rounded-2xl bg-white/6 border border-white/10 p-4">
                  <div class="text-white/85 font-semibold" id="p1t">1) VocÃª responde</div>
                  <div class="text-white/60 text-sm mt-1" id="p1s">Objetivo, canais, frequÃªncia, orÃ§amento e prazo.</div>
                </div>
                <div class="rounded-2xl bg-white/6 border border-white/10 p-4">
                  <div class="text-white/85 font-semibold" id="p2t">2) VocÃª recebe pacotes</div>
                  <div class="text-white/60 text-sm mt-1" id="p2s">Essencial â€¢ Recomendado â€¢ Agressivo.</div>
                </div>
                <div class="rounded-2xl bg-white/6 border border-white/10 p-4">
                  <div class="text-white/85 font-semibold" id="p3t">3) VocÃª personaliza</div>
                  <div class="text-white/60 text-sm mt-1" id="p3s">Marca serviÃ§os e vÃª economia por combo.</div>
                </div>
              </div>

              <div class="mt-5 rounded-2xl bg-gradient-to-r from-indigo-500/20 to-sky-500/20 border border-white/10 p-4">
                <div class="text-sm font-semibold text-white/90" id="dealTitle">SimulaÃ§Ã£o de desconto (combo)</div>
                <div class="text-white/70 text-sm mt-1" id="dealText">2 serviÃ§os: 5% â€¢ 3: 8% â€¢ 4+: 12% (simulado)</div>
              </div>
            </div>
          </div>
        </div>

        <div class="px-6 md:px-10 py-4 border-t border-white/10 bg-black/15 text-xs text-white/55" id="footerLine">
          *Descontos de combo sÃ£o simulados. Planos jÃ¡ incluem desconto por perÃ­odo.
        </div>
      </section>
    </div>
  </main>

  <!-- MODAL -->
  <div id="modal" class="fixed inset-0 hidden items-end md:items-center justify-center p-0 md:p-8">
    <div id="backdrop" class="absolute inset-0 bg-black/65"></div>

    <div id="modalPanel" class="panel-enter relative w-full md:w-[min(1120px,96vw)] glass rounded-t-[28px] md:rounded-[28px] overflow-hidden max-h-[92vh] md:max-h-[90vh] flex flex-col">
      <div class="px-5 md:px-7 py-4 border-b border-white/10 bg-black/15 flex items-center justify-between gap-3">
        <div class="flex items-center gap-3">
          <div class="h-10 w-10 rounded-2xl bg-white/10 border border-white/12 flex items-center justify-center">
            <span class="text-lg">âš¡</span>
          </div>
          <div>
            <div class="font-extrabold tracking-tight" id="modalTitle">Quiz inteligente</div>
            <div class="text-xs text-white/60" id="modalSub">Pacotes recomendados â€¢ SimulaÃ§Ã£o de desconto â€¢ PrÃ©-preenchimento</div>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <div class="hidden sm:inline-flex items-center gap-1 p-1 rounded-2xl btn-ghost">
            <button id="langPT" class="ring-focus px-3 py-2 rounded-xl text-sm font-semibold bg-white/10">ðŸ‡§ðŸ‡· PT</button>
            <button id="langEN" class="ring-focus px-3 py-2 rounded-xl text-sm font-semibold text-white/70">ðŸ‡ºðŸ‡¸ EN</button>
          </div>

          <button id="closeModal" class="ring-focus px-3 py-2 rounded-2xl btn-ghost text-white/85">âœ•</button>
        </div>
      </div>

      <div class="flex-1 overflow-y-auto">
        <div class="grid md:grid-cols-[1.35fr_.65fr]">
          <div class="p-5 md:p-7">
            <div id="app"></div>
          </div>

          <aside class="p-5 md:p-7 border-t md:border-t-0 md:border-l border-white/10 bg-black/15">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold text-white/90" id="sideTitle">Seu resumo</h3>
              <span class="text-xs text-white/55" id="progressText">0%</span>
            </div>

            <div class="mt-3 w-full h-2 rounded-full bg-white/10 overflow-hidden">
              <div id="progressBar" class="h-2 rounded-full bg-gradient-to-r from-indigo-400 to-sky-400" style="width:0%"></div>
            </div>

            <div id="sideSummary" class="mt-4 text-sm text-white/80 space-y-2">
              <div class="text-white/55" id="sideEmpty">Responda o quiz para ver recomendaÃ§Ãµes.</div>
            </div>

            <div class="mt-5 rounded-3xl border border-white/10 bg-white/5 p-4">
              <div class="flex items-center justify-between mb-2">
                <div class="text-sm font-semibold text-white/90" id="simTitle">SimulaÃ§Ã£o</div>
                <span class="text-xs text-white/55">live</span>
              </div>
              <div id="sideTotals" class="text-sm text-white/80 space-y-1">
                <div class="flex justify-between"><span id="lblSub">Subtotal</span><span>â€”</span></div>
                <div class="flex justify-between"><span id="lblDisc">Desconto</span><span>â€”</span></div>
                <div class="flex justify-between"><span id="lblPlans">Planos</span><span>â€”</span></div>
                <div class="flex justify-between font-extrabold"><span id="lblTotal">Total</span><span>â€”</span></div>
              </div>
              <div class="mt-2 text-xs text-white/55" id="sideNote">*Combos: 2=5%, 3=8%, 4+=12% (simulado).</div>
            </div>

            <div class="mt-4 text-xs text-white/50" id="sideStrategy">
              EstratÃ©gia: comeÃ§amos no essencial e evoluÃ­mos para maior impacto.
            </div>
          </aside>
        </div>
      </div>

      <div class="px-5 md:px-7 py-4 border-t border-white/10 bg-black/15 flex items-center justify-between gap-3">
        <button id="backBtn" class="hidden ring-focus px-4 py-2.5 rounded-2xl btn-ghost text-white/90">Voltar</button>
        <div class="text-xs text-white/55" id="stepCounter">â€”</div>
        <button id="nextBtn" class="hidden ring-focus px-4 py-2.5 rounded-2xl btn-primary font-bold">Continuar</button>
      </div>
    </div>
  </div>

<script>
(() => {
  // =========================
  // 1) DADOS EMBUTIDOS (SEM JSON EXTERNO)
  // =========================
  // Se quiser editar preÃ§os/serviÃ§os, edite SOMENTE este objeto.
  const EMBEDDED_DATA = {"orcamento":{"observacoes":"PreÃ§os podem variar conforme briefing, complexidade, revisÃµes e prazo. PeÃ§a orÃ§amento para confirmaÃ§Ã£o.","categorias":[{"nome":"Imagens","servicos":[{"titulo":"CriaÃ§Ã£o de Imagem (BÃ¡sica)","titulo_venda":"Imagem (BÃ¡sica)","descricao":"Ideal para posts simples, anÃºncios e artes rÃ¡pidas.","extras":"Entrega em alta resoluÃ§Ã£o, 1 variaÃ§Ã£o.","preco":50},{"titulo":"CriaÃ§Ã£o de Imagem (Profissional)","titulo_venda":"Imagem (Profissional)","descricao":"Artes mais elaboradas para campanhas, carrossÃ©is e conteÃºdo premium.","extras":"2 variaÃ§Ãµes + ajustes finos.","preco":90},{"titulo":"CriaÃ§Ã£o de Imagem (Premium)","titulo_venda":"Imagem (Premium)","descricao":"DireÃ§Ã£o de arte completa, alto impacto e acabamento premium.","extras":"3 variaÃ§Ãµes + refinamento detalhado.","preco":140}]},{"nome":"VÃ­deos","servicos":[{"titulo":"EdiÃ§Ã£o de VÃ­deo (BÃ¡sica)","titulo_venda":"VÃ­deo (BÃ¡sico)","descricao":"Cortes, legenda simples e ajustes bÃ¡sicos.","extras":"AtÃ© 30s.","preco":120},{"titulo":"EdiÃ§Ã£o de VÃ­deo (Profissional)","titulo_venda":"VÃ­deo (Profissional)","descricao":"Ritmo, cortes avanÃ§ados, motion e legendas melhores.","extras":"AtÃ© 60s.","preco":250},{"titulo":"EdiÃ§Ã£o de VÃ­deo (Premium)","titulo_venda":"VÃ­deo (Premium)","descricao":"EdiÃ§Ã£o avanÃ§ada com estÃ©tica premium, motion e storytelling.","extras":"AtÃ© 90s.","preco":420},{"titulo":"EdiÃ§Ã£o de VÃ­deo (Sob Consulta)","titulo_venda":"VÃ­deo (Sob Consulta)","descricao":"Projetos longos, complexos ou com demanda especÃ­fica.","extras":"OrÃ§amento personalizado.","preco":0}]},{"nome":"Planos de Social Media (ConteÃºdo Mensal)","servicos":[{"titulo":"Plano Social Media (BÃ¡sico)","titulo_venda":"Plano Mensal (BÃ¡sico)","descricao":"ConteÃºdo mensal para manter presenÃ§a e consistÃªncia.","inclui":["10 imagens por mÃªs","2 vÃ­deos curtos por mÃªs"],"beneficios":["ConsistÃªncia","AparÃªncia profissional"],"precos_por_periodo":[{"periodo":"Mensal","preco_total_sem_desc":750,"desconto_percentual":0,"preco_total_com_desc":750},{"periodo":"Trimestral","preco_total_sem_desc":2250,"desconto_percentual":10,"preco_total_com_desc":2025},{"periodo":"Semestral","preco_total_sem_desc":4500,"desconto_percentual":15,"preco_total_com_desc":3825},{"periodo":"Anual","preco_total_sem_desc":9000,"desconto_percentual":20,"preco_total_com_desc":7200}]},{"titulo":"Plano Social Media (Profissional)","titulo_venda":"Plano Mensal (Profissional)","descricao":"Para crescer com mais volume e variedade.","inclui":["20 imagens por mÃªs","4 vÃ­deos curtos por mÃªs"],"beneficios":["Maior volume","Melhor performance"],"precos_por_periodo":[{"periodo":"Mensal","preco_total_sem_desc":1400,"desconto_percentual":0,"preco_total_com_desc":1400},{"periodo":"Trimestral","preco_total_sem_desc":4200,"desconto_percentual":10,"preco_total_com_desc":3780},{"periodo":"Semestral","preco_total_sem_desc":8400,"desconto_percentual":15,"preco_total_com_desc":7140},{"periodo":"Anual","preco_total_sem_desc":16800,"desconto_percentual":20,"preco_total_com_desc":13440}]},{"titulo":"Plano Social Media (Premium)","titulo_venda":"Plano Mensal (Premium)","descricao":"MÃ¡ximo impacto com estÃ©tica premium + volume alto.","inclui":["30 imagens por mÃªs","8 vÃ­deos curtos por mÃªs"],"beneficios":["AltÃ­ssima consistÃªncia","PresenÃ§a forte"],"precos_por_periodo":[{"periodo":"Mensal","preco_total_sem_desc":2500,"desconto_percentual":0,"preco_total_com_desc":2500},{"periodo":"Trimestral","preco_total_sem_desc":7500,"desconto_percentual":10,"preco_total_com_desc":6750},{"periodo":"Semestral","preco_total_sem_desc":15000,"desconto_percentual":15,"preco_total_com_desc":12750},{"periodo":"Anual","preco_total_sem_desc":30000,"desconto_percentual":20,"preco_total_com_desc":24000}]}]},{"nome":"ServiÃ§os Avulsos","servicos":[{"titulo":"CriaÃ§Ã£o de Logo","titulo_venda":"Logo","descricao":"Logo profissional para a sua marca.","extras":"2 opÃ§Ãµes + ajustes.","preco":220},{"titulo":"Identidade Visual","titulo_venda":"Identidade Visual","descricao":"Identidade completa com padrÃµes, cores e tipografia.","extras":"Guia de marca.","preco":480},{"titulo":"Website","titulo_venda":"Website","descricao":"Site institucional simples e elegante.","extras":"PÃ¡gina Ãºnica / landing.","preco":650},{"titulo":"Roteiro","titulo_venda":"Roteiro","descricao":"Roteiro para vÃ­deos curtos e campanhas.","extras":"Estrutura + CTA.","preco":120},{"titulo":"NarraÃ§Ã£o","titulo_venda":"NarraÃ§Ã£o","descricao":"NarraÃ§Ã£o para vÃ­deos e anÃºncios.","extras":"Ãudio limpo.","preco":150},{"titulo":"Trilha Sonora","titulo_venda":"Trilha Sonora","descricao":"Trilha adequada ao seu conteÃºdo.","extras":"Escolha/ediÃ§Ã£o.","preco":90},{"titulo":"Copywriting","titulo_venda":"Copywriting","descricao":"Texto persuasivo para anÃºncios e pÃ¡ginas.","extras":"1 versÃ£o + variaÃ§Ã£o.","preco":180},{"titulo":"Pacote de AnÃºncios","titulo_venda":"Pacote de AnÃºncios","descricao":"Criativos para campanhas de trÃ¡fego pago.","extras":"3 peÃ§as.","preco":300}]},{"nome":"CriaÃ§Ã£o de Personagem Personalizado","servicos":[{"titulo":"Personagem (BÃ¡sico)","titulo_venda":"Personagem (BÃ¡sico)","descricao":"CriaÃ§Ã£o simples do personagem.","extras":"1 pose.","preco":180},{"titulo":"Personagem (Profissional)","titulo_venda":"Personagem (Profissional)","descricao":"Mais detalhes e acabamento.","extras":"2 poses.","preco":280},{"titulo":"Personagem (Premium)","titulo_venda":"Personagem (Premium)","descricao":"Acabamento premium e mais detalhes.","extras":"3 poses.","preco":380}]},{"nome":"Pacotes de Personagem Personalizado","servicos":[{"titulo":"Pacote Personagem Starter","titulo_venda":"Pacote Starter","descricao":"Personagem + variaÃ§Ãµes para comeÃ§ar.","extras":"4 poses.","preco":520},{"titulo":"Pacote Personagem Pro","titulo_venda":"Pacote Pro","descricao":"Mais poses e expressÃµes.","extras":"8 poses.","preco":920},{"titulo":"Pacote Personagem Premium","titulo_venda":"Pacote Premium","descricao":"ConteÃºdo completo do personagem.","extras":"12 poses + expressÃµes.","preco":1380},{"titulo":"Pacote Personagem Max","titulo_venda":"Pacote Max","descricao":"Pacote completo sob demanda.","extras":"20 poses + expressÃµes.","preco":2200}]}]}};

  // =========================
  // 2) DOM
  // =========================
  const modal = document.getElementById('modal');
  const modalPanel = document.getElementById('modalPanel');
  const openModalBtn = document.getElementById('openModal');
  const closeModalBtn = document.getElementById('closeModal');
  const backdrop = document.getElementById('backdrop');

  const app = document.getElementById('app');
  const sideSummary = document.getElementById('sideSummary');
  const progressBar = document.getElementById('progressBar');
  const progressText = document.getElementById('progressText');
  const stepCounter = document.getElementById('stepCounter');
  const backBtn = document.getElementById('backBtn');
  const nextBtn = document.getElementById('nextBtn');
  const sideTotals = document.getElementById('sideTotals');

  const langPTTop = document.getElementById('langPTTop');
  const langENTop = document.getElementById('langENTop');
  const langPT = document.getElementById('langPT');
  const langEN = document.getElementById('langEN');

  // =========================
  // 3) Utils
  // =========================
  const escapeHtml = (s)=> String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  const setFade = (html)=>{
    app.innerHTML = html;
    const el = app.querySelector('.fade');
    if(el) setTimeout(()=>el.classList.add('show'), 10);
  };
  const showModal = ()=>{
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    setTimeout(()=>modalPanel.classList.add('show'), 10);
  };
  const hideModal = ()=>{
    modalPanel.classList.remove('show');
    setTimeout(()=>{
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }, 160);
  };

  openModalBtn.addEventListener('click', showModal);
  closeModalBtn.addEventListener('click', hideModal);
  backdrop.addEventListener('click', hideModal);
  window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && !modal.classList.contains('hidden')) hideModal(); });

  // =========================
  // 4) i18n
  // =========================
  const i18n = {
    pt: {
      heroBadge:"Quiz inteligente â€¢ Combos â€¢ SimulaÃ§Ã£o de desconto",
      heroTitle:"Encontre o serviÃ§o ideal em minutos.",
      heroSub:"Responda em ~2 minutos. No final, selecione os serviÃ§os e vÃ¡ para o orÃ§amento jÃ¡ preenchido.",
      ctaStart:"ComeÃ§ar quiz",
      miniNoteTitle:"Dica rÃ¡pida",
      miniNoteText:"Sem arquivo externo: os serviÃ§os jÃ¡ estÃ£o embutidos no HTML.",
      b1t:"RecomendaÃ§Ã£o automÃ¡tica", b1s:"Sugere serviÃ§os e pacotes com base no objetivo.",
      b2t:"Upsell inteligente", b2s:"Planos e add-ons aparecem sÃ³ quando fazem sentido.",
      b3t:"Finaliza com 1 clique", b3s:"Direciona para o orÃ§amento com tudo preenchido.",
      previewTitle:"Como funciona", previewTime:"~2 min",
      p1t:"1) VocÃª responde", p1s:"Objetivo, canais, frequÃªncia, orÃ§amento e prazo.",
      p2t:"2) VocÃª recebe pacotes", p2s:"Essencial â€¢ Recomendado â€¢ Agressivo.",
      p3t:"3) VocÃª personaliza", p3s:"Marca serviÃ§os e vÃª economia por combo.",
      dealTitle:"SimulaÃ§Ã£o de desconto (combo)", dealText:"2 serviÃ§os: 5% â€¢ 3: 8% â€¢ 4+: 12% (simulado)",
      footerLine:"*Descontos de combo sÃ£o simulados. Planos jÃ¡ incluem desconto por perÃ­odo.",

      modalTitle:"Quiz inteligente",
      modalSub:"Pacotes recomendados â€¢ SimulaÃ§Ã£o de desconto â€¢ PrÃ©-preenchimento",
      sideTitle:"Seu resumo",
      sideEmpty:"Responda o quiz para ver recomendaÃ§Ãµes.",
      simTitle:"SimulaÃ§Ã£o",
      lblSub:"Subtotal (avulsos)",
      lblDisc:"Desconto combo",
      lblPlans:"Planos",
      lblTotal:"Total",
      sideNote:"*Combos: 2=5%, 3=8%, 4+=12% (simulado).",
      sideStrategy:"EstratÃ©gia: comeÃ§amos no essencial e evoluÃ­mos para maior impacto.",
      back:"Voltar",
      next:"Continuar",

      startTitle:"Monte seu orÃ§amento em 2 minutos",
      startSubtitle:"Responda algumas perguntas e receba pacotes recomendados + simulaÃ§Ã£o de economia.",
      startCTA:"ComeÃ§ar",

      q_objective:"1) Qual o objetivo principal?",
      o_sales:"Gerar vendas / conversÃ£o (promoÃ§Ã£o, campanhas, anÃºncios)",
      o_social:"ConteÃºdo contÃ­nuo para redes sociais (semanal/mensal)",
      o_branding:"Fortalecer marca / branding (visual profissional)",
      o_edu:"Educar / conteÃºdo tÃ©cnico (explicar, ensinar, tutorial)",

      q_channels:"2) Onde vocÃª vai publicar?",
      ch_instagram:"Instagram (Feed/Stories/Reels)",
      ch_tiktok:"TikTok",
      ch_shorts:"YouTube Shorts",
      ch_whatsapp:"WhatsApp",
      ch_site:"Site",
      ch_multi:"VÃ¡rios canais",

      q_freq:"3) FrequÃªncia desejada",
      f_one:"Pontual (uma campanha/entrega Ãºnica)",
      f_week:"Semanal (consistÃªncia)",
      f_month:"Mensal (conteÃºdo contÃ­nuo)",

      q_type:"4) VocÃª jÃ¡ sabe qual tipo de serviÃ§o procura?",
      type_auto:"NÃ£o tenho certeza (quero recomendaÃ§Ã£o)",

      q_assets:"5) VocÃª jÃ¡ tem materiais prontos?",
      a_logo:"Tenho logo/identidade visual",
      a_photos:"Tenho fotos do produto/serviÃ§o",
      a_videos:"Tenho vÃ­deos gravados",
      a_text:"Tenho roteiro/textos",
      a_none:"NÃ£o tenho nada ainda",

      q_volume:"6) Volume aproximado",
      v_low:"Pequeno (1â€“5 artes / vÃ­deo curto)",
      v_mid:"MÃ©dio (6â€“15 artes / 30s)",
      v_high:"Alto (>15 artes / vÃ­deo premium)",

      q_style:"7) Estilo preferido",
      s_clean:"Minimalista / clean",
      s_promo:"Impactante / promocional",
      s_premium:"Premium / institucional",
      s_fun:"Criativo / divertido",

      q_preference:"8) Prefere pacote completo ou avulso?",
      p_combo:"Pacote (combos com economia)",
      p_single:"Avulso (apenas 1 serviÃ§o)",
      p_any:"Indiferente",

      q_budget:"9) Faixa de orÃ§amento (aprox.)",
      b_100:"AtÃ© R$100",
      b_300:"AtÃ© R$300",
      b_800:"AtÃ© R$800",
      b_more:"Acima de R$800",

      q_deadline:"10) Prazo desejado (opcional)",
      d_3:"AtÃ© 3 dias",
      d_7:"AtÃ© 7 dias",
      d_more:"Mais que 7 dias",
      d_skip:"NÃ£o sei / sem pressa",

      clickToAdvance:"Clique em uma opÃ§Ã£o para avanÃ§ar.",
      pickMulti:"Selecione 1 ou mais e continue.",

      resultsTitle:"Resultado do quiz",
      resultsSub:"Escolha um pacote pronto (recomendado) ou personalize marcando os serviÃ§os.",
      redo:"Refazer",
      tier_essential:"Essencial",
      tier_recommended:"Recomendado",
      tier_aggressive:"Agressivo",
      badge_essential:"ComeÃ§ar rÃ¡pido",
      badge_recommended:"Melhor custo-benefÃ­cio",
      badge_aggressive:"MÃ¡ximo impacto",
      apply:"Aplicar",
      estimatedTotal:"Total estimado",
      simulated:"*SimulaÃ§Ã£o automÃ¡tica. VocÃª pode adicionar/remover itens abaixo.",
      customizeTitle:"ServiÃ§os sugeridos (personalize)",
      customizeHint:"Dica: 2+ serviÃ§os liberam desconto de combo.",
      planPeriod:"PerÃ­odo do plano",
      saves:"economiza",
      summaryAuto:"Resumo automÃ¡tico (vai no orÃ§amento)",
      finalize:"Finalizar e ir para o orÃ§amento (prÃ©-preenchido)",
      copy:"Copiar resumo",
      copied:"Copiado!",
      notes:"ObservaÃ§Ãµes"
    },

    en: {
      heroBadge:"Smart quiz â€¢ Bundles â€¢ Discount simulation",
      heroTitle:"Find the perfect service in minutes.",
      heroSub:"Answer in ~2 minutes. Then select services and go to a pre-filled quote form.",
      ctaStart:"Start quiz",
      miniNoteTitle:"Quick tip",
      miniNoteText:"No external file: services are embedded in this HTML.",
      b1t:"Auto recommendations", b1s:"Suggests services and bundles based on your goal.",
      b2t:"Smart upsell", b2s:"Plans and add-ons appear only when it makes sense.",
      b3t:"Finish in 1 click", b3s:"Redirects to a pre-filled quote page.",
      previewTitle:"How it works", previewTime:"~2 min",
      p1t:"1) You answer", p1s:"Goal, channels, frequency, budget and deadline.",
      p2t:"2) You get bundles", p2s:"Essential â€¢ Recommended â€¢ Aggressive.",
      p3t:"3) You customize", p3s:"Select services and see bundle savings.",
      dealTitle:"Bundle discount simulation", dealText:"2 services: 5% â€¢ 3: 8% â€¢ 4+: 12% (simulated)",
      footerLine:"*Bundle discounts are simulated. Plans already include period discounts.",

      modalTitle:"Smart quiz",
      modalSub:"Recommended bundles â€¢ Discount simulation â€¢ Pre-filling",
      sideTitle:"Your summary",
      sideEmpty:"Answer the quiz to see recommendations.",
      simTitle:"Simulation",
      lblSub:"Subtotal (one-offs)",
      lblDisc:"Bundle discount",
      lblPlans:"Plans",
      lblTotal:"Total",
      sideNote:"*Bundles: 2=5%, 3=8%, 4+=12% (simulated).",
      sideStrategy:"Strategy: start with essentials, then boost impact.",
      back:"Back",
      next:"Continue",

      startTitle:"Build your quote in 2 minutes",
      startSubtitle:"Answer a few questions and get recommended bundles + savings simulation.",
      startCTA:"Start",

      q_objective:"1) What's your main goal?",
      o_sales:"Drive sales / conversions (promos, campaigns, ads)",
      o_social:"Ongoing social media content (weekly/monthly)",
      o_branding:"Strengthen brand / branding (professional visuals)",
      o_edu:"Educate / technical content (explain, teach, tutorials)",

      q_channels:"2) Where will you publish?",
      ch_instagram:"Instagram (Feed/Stories/Reels)",
      ch_tiktok:"TikTok",
      ch_shorts:"YouTube Shorts",
      ch_whatsapp:"WhatsApp",
      ch_site:"Website",
      ch_multi:"Multiple channels",

      q_freq:"3) Desired frequency",
      f_one:"One-off (single campaign/delivery)",
      f_week:"Weekly (consistency)",
      f_month:"Monthly (ongoing content)",

      q_type:"4) Do you know what type of service you want?",
      type_auto:"Not sure (recommend for me)",

      q_assets:"5) Do you have materials ready?",
      a_logo:"I have a logo/visual identity",
      a_photos:"I have product/service photos",
      a_videos:"I have recorded videos",
      a_text:"I have scripts/texts",
      a_none:"I have nothing yet",

      q_volume:"6) Estimated volume",
      v_low:"Small (1â€“5 designs / short video)",
      v_mid:"Medium (6â€“15 designs / 30s)",
      v_high:"High (>15 designs / premium video)",

      q_style:"7) Preferred style",
      s_clean:"Minimal / clean",
      s_promo:"Bold / promotional",
      s_premium:"Premium / corporate",
      s_fun:"Creative / fun",

      q_preference:"8) Prefer bundle or single service?",
      p_combo:"Bundle (with savings)",
      p_single:"Single service",
      p_any:"No preference",

      q_budget:"9) Budget range (approx.)",
      b_100:"Up to R$100",
      b_300:"Up to R$300",
      b_800:"Up to R$800",
      b_more:"Above R$800",

      q_deadline:"10) Deadline (optional)",
      d_3:"Up to 3 days",
      d_7:"Up to 7 days",
      d_more:"More than 7 days",
      d_skip:"Not sure / no rush",

      clickToAdvance:"Click an option to continue.",
      pickMulti:"Select one or more, then continue.",

      resultsTitle:"Your quiz results",
      resultsSub:"Pick a recommended bundle or customize by selecting services.",
      redo:"Restart",
      tier_essential:"Essential",
      tier_recommended:"Recommended",
      tier_aggressive:"Aggressive",
      badge_essential:"Start fast",
      badge_recommended:"Best value",
      badge_aggressive:"Max impact",
      apply:"Apply",
      estimatedTotal:"Estimated total",
      simulated:"*Automatic simulation. You can add/remove items below.",
      customizeTitle:"Suggested services (customize)",
      customizeHint:"Tip: 2+ services unlock bundle discount.",
      planPeriod:"Plan period",
      saves:"save",
      summaryAuto:"Auto summary (goes to quote)",
      finalize:"Finish and go to quote (pre-filled)",
      copy:"Copy summary",
      copied:"Copied!",
      notes:"Notes"
    }
  };

  let currentLang = (localStorage.getItem('comercias_lang') || '').toLowerCase();
  if(currentLang !== 'pt' && currentLang !== 'en'){
    const nav = (navigator.language || 'pt').toLowerCase();
    currentLang = nav.startsWith('en') ? 'en' : 'pt';
  }
  const t = (k)=> i18n[currentLang]?.[k] ?? k;

  // =========================
  // 5) InicializaÃ§Ã£o dos dados
  // =========================
  const dadosJSON = EMBEDDED_DATA;
  const categorias = (dadosJSON.orcamento && Array.isArray(dadosJSON.orcamento.categorias)) ? dadosJSON.orcamento.categorias : [];
  const observacoes = (dadosJSON.orcamento && dadosJSON.orcamento.observacoes) ? dadosJSON.orcamento.observacoes : '';

  // Normaliza serviÃ§os
  const toArrayText = (arr)=> Array.isArray(arr) ? arr.join(' ') : '';
  const allServices = [];
  categorias.forEach(cat=>{
    (cat.servicos||[]).forEach((s, idx)=>{
      const isPlan = Array.isArray(s.precos_por_periodo) && s.precos_por_periodo.length;
      const displayTitle = s.titulo_venda || s.titulo || 'Service';

      const fullText = [
        displayTitle, s.titulo||'', s.descricao||'', s.extras||'',
        toArrayText(s.inclui), toArrayText(s.beneficios)
      ].join(' ').toLowerCase();

      let priceMin = null;
      if(isPlan){
        const mensal = s.precos_por_periodo.find(p => String(p.periodo).toLowerCase().includes('mensal')) || s.precos_por_periodo[0];
        priceMin = mensal ? Number(mensal.preco_total_com_desc) : null;
      } else if(typeof s.preco === 'number'){
        priceMin = Number(s.preco);
      }

      allServices.push(Object.assign({}, s, {
        __id: `${cat.nome}::${displayTitle}::${idx}`,
        __categoria: cat.nome,
        __displayTitle: displayTitle,
        __isPlan: isPlan,
        __priceMin: priceMin,
        __fullText: fullText
      }));
    });
  });

  // =========================
  // 6) QuestÃµes (agora SEM depender de fetch)
  // =========================
  const questions = [
    { id:'start', type:'screen' },
    { id:'objetivo', type:'single', textKey:'q_objective', options:[
      {value:'vendas', labelKey:'o_sales'},
      {value:'social', labelKey:'o_social'},
      {value:'branding', labelKey:'o_branding'},
      {value:'educativo', labelKey:'o_edu'}
    ]},
    { id:'canais', type:'multi', min:1, textKey:'q_channels', options:[
      {value:'instagram', labelKey:'ch_instagram'},
      {value:'tiktok', labelKey:'ch_tiktok'},
      {value:'shorts', labelKey:'ch_shorts'},
      {value:'whatsapp', labelKey:'ch_whatsapp'},
      {value:'site', labelKey:'ch_site'},
      {value:'multi', labelKey:'ch_multi'}
    ]},
    { id:'frequencia', type:'single', textKey:'q_freq', options:[
      {value:'pontual', labelKey:'f_one'},
      {value:'semanal', labelKey:'f_week'},
      {value:'mensal', labelKey:'f_month'}
    ]},
    { id:'tipo', type:'single', textKey:'q_type', options:[
      {value:'__AUTO__', labelKey:'type_auto'},
      ...categorias.map(c=>({value:c.nome, label:c.nome}))
    ]},
    { id:'materiais', type:'multi', min:1, textKey:'q_assets', options:[
      {value:'tem_logo', labelKey:'a_logo'},
      {value:'tem_fotos', labelKey:'a_photos'},
      {value:'tem_videos', labelKey:'a_videos'},
      {value:'tem_texto', labelKey:'a_text'},
      {value:'nada', labelKey:'a_none'}
    ]},
    { id:'volume', type:'single', textKey:'q_volume', options:[
      {value:'baixo', labelKey:'v_low'},
      {value:'medio', labelKey:'v_mid'},
      {value:'alto', labelKey:'v_high'}
    ]},
    { id:'estilo', type:'single', textKey:'q_style', options:[
      {value:'clean', labelKey:'s_clean'},
      {value:'promo', labelKey:'s_promo'},
      {value:'premium', labelKey:'s_premium'},
      {value:'criativo', labelKey:'s_fun'}
    ]},
    { id:'formato', type:'single', textKey:'q_preference', options:[
      {value:'pacote', labelKey:'p_combo'},
      {value:'avulso', labelKey:'p_single'},
      {value:'indiferente', labelKey:'p_any'}
    ]},
    { id:'orcamento', type:'single', textKey:'q_budget', options:[
      {value:100, labelKey:'b_100'},
      {value:300, labelKey:'b_300'},
      {value:800, labelKey:'b_800'},
      {value:999999, labelKey:'b_more'}
    ]},
    { id:'prazo', type:'single', textKey:'q_deadline', options:[
      {value:'3d', labelKey:'d_3'},
      {value:'7d', labelKey:'d_7'},
      {value:'maior', labelKey:'d_more'},
      {value:'__SKIP__', labelKey:'d_skip'}
    ]}
  ];

  // =========================
  // 7) FormataÃ§Ã£o / Totais / Scoring
  // =========================
  const state = { answers:{}, index:0 };
  let selectedMap = new Map();

  const formatPrice = (n)=>{
    const num = Number(n);
    if(!isFinite(num)) return String(n);
    return new Intl.NumberFormat(currentLang === 'en' ? 'en-US' : 'pt-BR', {style:'currency', currency:'BRL'}).format(num);
  };

  const comboDiscountPerc = (qtd)=> (qtd>=4?12:(qtd===3?8:(qtd===2?5:0)));

  const getServiceById = (id)=> allServices.find(s=>s.__id===id);

  const scoreService = (s, a)=>{
    let score = 0;
    if(a.tipo && a.tipo !== '__AUTO__' && s.__categoria === a.tipo) score += 6;

    const budget = Number(a.orcamento) || Infinity;
    if(typeof s.__priceMin === 'number'){
      if(budget === 999999) score += 1;
      else {
        if(s.__priceMin <= budget) score += 4;
        else score -= 6;
        if(s.__priceMin <= budget/2) score += 1;
      }
    }

    const txt = (s.__fullText||'');
    if(a.objetivo === 'vendas'){
      if(/\bvenda|vendas|convers|promo|campanh|ads|an[uÃº]ncio|cta|oferta|reserv/ig.test(txt)) score += 5;
    }
    if(a.objetivo === 'social'){
      if(s.__isPlan) score += (a.frequencia === 'mensal' ? 10 : 6);
      if(/\binstagram|tiktok|reels|shorts|stories|conte[uÃº]do|feed/ig.test(txt)) score += 4;
    }
    if(a.objetivo === 'branding'){
      if(/\blogo|identidade|brand|marca|website|site|manual/ig.test(txt)) score += 6;
    }
    if(a.objetivo === 'educativo'){
      if(/\btutorial|trein|curso|explic|roteiro/ig.test(txt)) score += 5;
      if(/\bnarra/ig.test(txt)) score += 2;
    }

    const canais = Array.isArray(a.canais) ? a.canais : [];
    if(canais.includes('site') && /\bwebsite|site|landing/ig.test(txt)) score += 3;
    if((canais.includes('instagram')||canais.includes('tiktok')||canais.includes('shorts')) && /\breels|tiktok|shorts|vertical/ig.test(txt)) score += 2;

    if(a.prazo === '3d' && /\br[aÃ¡]pid|express/ig.test(txt)) score += 2;
    if(a.estilo === 'premium' && /\bpremium|institucional|corporativo/ig.test(txt)) score += 1;
    if(a.estilo === 'promo' && /\bpromo|oferta|impact/ig.test(txt)) score += 1;
    if(a.estilo === 'clean' && /\bminimal|clean|simples/ig.test(txt)) score += 1;

    return score;
  };

  const pickTopServices = (a, limit)=>{
    const budget = Number(a.orcamento) || Infinity;
    const scored = allServices.map(s => ({ s, score: scoreService(s, a) }));
    const filtered = scored.filter(x=>{
      if(budget === 999999) return true;
      if(typeof x.s.__priceMin !== 'number') return true;
      return x.s.__priceMin <= budget;
    });
    filtered.sort((A,B)=>{
      if(B.score !== A.score) return B.score - A.score;
      const pa = A.s.__priceMin ?? 999999;
      const pb = B.s.__priceMin ?? 999999;
      return pa - pb;
    });
    const top = filtered.filter(x=>x.score > 0).slice(0, limit).map(x=>x.s);
    return top.length ? top : filtered.slice(0, limit).map(x=>x.s);
  };

  const computeTotals = (selectedArr)=>{
    let avulsoSubtotal = 0;
    let planTotal = 0;
    let planSavings = 0;

    const avulsos = [];
    const plans = [];

    selectedArr.forEach(it=>{
      const s = getServiceById(it.id);
      if(!s) return;
      if(s.__isPlan) plans.push({ s, period: it.period || 'Mensal' });
      else avulsos.push(s);
    });

    avulsos.forEach(s=>{
      const p = Number(s.preco ?? s.__priceMin ?? 0);
      avulsoSubtotal += (isFinite(p) ? p : 0);
    });

    const comboPerc = comboDiscountPerc(avulsos.length);
    const comboDiscount = Math.round((avulsoSubtotal * comboPerc) * 100) / 100;
    const avulsoTotal = avulsoSubtotal - comboDiscount;

    plans.forEach(({s, period})=>{
      const opt = Array.isArray(s.precos_por_periodo)
        ? (s.precos_por_periodo.find(p => String(p.periodo).toLowerCase() === String(period).toLowerCase())
           || s.precos_por_periodo.find(p => String(p.periodo).toLowerCase().includes(String(period).toLowerCase()))
           || s.precos_por_periodo[0])
        : null;

      if(opt){
        planTotal += Number(opt.preco_total_com_desc || 0);
        const sem = Number(opt.preco_total_sem_desc || 0);
        const com = Number(opt.preco_total_com_desc || 0);
        planSavings += Math.max(0, sem - com);
      } else {
        planTotal += Number(s.__priceMin || 0);
      }
    });

    const total = avulsoTotal + planTotal;
    return { avulsoSubtotal, comboPerc, comboDiscount, planTotal, planSavings, total };
  };

  const renderTotalsBox = (tot)=>{
    const discLabel = tot.comboPerc ? `-${tot.comboPerc}%` : 'â€”';
    sideTotals.innerHTML = `
      <div class="flex justify-between"><span>${escapeHtml(t('lblSub'))}</span><span>${formatPrice(tot.avulsoSubtotal||0)}</span></div>
      <div class="flex justify-between"><span>${escapeHtml(t('lblDisc'))} ${escapeHtml(discLabel)}</span><span>${tot.comboDiscount ? '-'+formatPrice(tot.comboDiscount) : 'â€”'}</span></div>
      <div class="flex justify-between"><span>${escapeHtml(t('lblPlans'))}</span><span>${tot.planTotal ? formatPrice(tot.planTotal) : 'â€”'}</span></div>
      <div class="flex justify-between font-extrabold"><span>${escapeHtml(t('lblTotal'))}</span><span>${formatPrice(tot.total||0)}</span></div>
    `;
  };

  // =========================
  // 8) UI copy + idioma (SEM render antes de init)
  // =========================
  let initialized = false;

  const applyCopy = ()=>{
    document.getElementById('heroBadge').textContent = t('heroBadge');
    document.getElementById('heroTitle').textContent = t('heroTitle');
    document.getElementById('heroSub').textContent = t('heroSub');
    document.getElementById('ctaStart').textContent = t('ctaStart');
    document.getElementById('miniNoteTitle').textContent = t('miniNoteTitle');
    document.getElementById('miniNoteText').textContent = t('miniNoteText');

    document.getElementById('b1t').textContent = t('b1t');
    document.getElementById('b1s').textContent = t('b1s');
    document.getElementById('b2t').textContent = t('b2t');
    document.getElementById('b2s').textContent = t('b2s');
    document.getElementById('b3t').textContent = t('b3t');
    document.getElementById('b3s').textContent = t('b3s');

    document.getElementById('previewTitle').textContent = t('previewTitle');
    document.getElementById('previewTime').textContent = t('previewTime');
    document.getElementById('p1t').textContent = t('p1t');
    document.getElementById('p1s').textContent = t('p1s');
    document.getElementById('p2t').textContent = t('p2t');
    document.getElementById('p2s').textContent = t('p2s');
    document.getElementById('p3t').textContent = t('p3t');
    document.getElementById('p3s').textContent = t('p3s');
    document.getElementById('dealTitle').textContent = t('dealTitle');
    document.getElementById('dealText').textContent = t('dealText');
    document.getElementById('footerLine').textContent = t('footerLine');

    document.getElementById('modalTitle').textContent = t('modalTitle');
    document.getElementById('modalSub').textContent = t('modalSub');
    document.getElementById('sideTitle').textContent = t('sideTitle');
    document.getElementById('sideEmpty').textContent = t('sideEmpty');
    document.getElementById('simTitle').textContent = t('simTitle');
    document.getElementById('lblSub').textContent = t('lblSub');
    document.getElementById('lblDisc').textContent = t('lblDisc');
    document.getElementById('lblPlans').textContent = t('lblPlans');
    document.getElementById('lblTotal').textContent = t('lblTotal');
    document.getElementById('sideNote').textContent = t('sideNote');
    document.getElementById('sideStrategy').textContent = t('sideStrategy');
    backBtn.textContent = t('back');
    nextBtn.textContent = t('next');
  };

  const setLang = (lang)=>{
    currentLang = lang;
    localStorage.setItem('comercias_lang', lang);

    // toggles
    langPTTop.classList.toggle('bg-white/10', lang==='pt');
    langENTop.classList.toggle('bg-white/10', lang==='en');
    langPTTop.classList.toggle('text-white/70', lang!=='pt');
    langENTop.classList.toggle('text-white/70', lang!=='en');

    langPT.classList.toggle('bg-white/10', lang==='pt');
    langEN.classList.toggle('bg-white/10', lang==='en');
    langPT.classList.toggle('text-white/70', lang!=='pt');
    langEN.classList.toggle('text-white/70', lang!=='en');

    applyCopy();
    renderTotalsBox(computeTotals(Array.from(selectedMap.values())));

    if(initialized){
      if(state.index >= questions.length) renderResults();
      else renderQuestion(state.index);
    }
  };

  langPTTop.addEventListener('click', ()=>setLang('pt'));
  langENTop.addEventListener('click', ()=>setLang('en'));
  langPT.addEventListener('click', ()=>setLang('pt'));
  langEN.addEventListener('click', ()=>setLang('en'));

  // =========================
  // 9) Sidebar / progress
  // =========================
  const updateProgress = ()=>{
    const visible = questions.filter(q=>q.type!=='screen').length;
    const currentVisible = Math.max(0, questions.slice(0, state.index).filter(q=>q.type!=='screen').length);
    const pct = Math.round((currentVisible / visible) * 100);
    progressBar.style.width = `${Math.min(100, Math.max(0, pct))}%`;
    progressText.textContent = `${Math.min(100, Math.max(0, pct))}%`;
    stepCounter.textContent = state.index === 0 ? 'â€”' : `${currentVisible} / ${visible}`;
  };

  const renderSideSummary = ()=>{
    const labels = currentLang === 'en'
      ? { objetivo:'Goal', canais:'Channels', frequencia:'Frequency', tipo:'Type', materiais:'Assets', volume:'Volume', estilo:'Style', formato:'Preference', orcamento:'Budget', prazo:'Deadline' }
      : { objetivo:'Objetivo', canais:'Canais', frequencia:'FrequÃªncia', tipo:'Tipo', materiais:'Materiais', volume:'Volume', estilo:'Estilo', formato:'PreferÃªncia', orcamento:'OrÃ§amento', prazo:'Prazo' };

    const lines = [];
    Object.keys(labels).forEach(k=>{
      if(typeof state.answers[k] === 'undefined') return;
      let v = state.answers[k];
      if(Array.isArray(v)) v = v.join(', ');
      if(k === 'orcamento') v = `R$${state.answers[k]}`;
      if(k === 'tipo' && v === '__AUTO__') v = t('type_auto');
      if(k === 'prazo' && v === '__SKIP__') v = t('d_skip');
      lines.push(`
        <div class="flex justify-between gap-3">
          <span class="text-white/55">${escapeHtml(labels[k])}</span>
          <span class="font-semibold text-white/90 text-right">${escapeHtml(String(v))}</span>
        </div>
      `);
    });

    sideSummary.innerHTML = lines.length
      ? `<div class="space-y-2">${lines.join('')}</div>`
      : `<div class="text-white/55">${escapeHtml(t('sideEmpty'))}</div>`;
  };

  const showNavButtons = (showBack, showNext)=>{
    backBtn.classList.toggle('hidden', !showBack);
    nextBtn.classList.toggle('hidden', !showNext);
  };

  // =========================
  // 10) Render do quiz
  // =========================
  const renderQuestion = (index)=>{
    state.index = index;
    updateProgress();
    renderSideSummary();
    showNavButtons(index > 0, false);

    if(index >= questions.length){ renderResults(); return; }
    const q = questions[index];

    if(q.type === 'screen'){
      setFade(`
        <div class="fade">
          <div class="rounded-3xl border border-white/10 bg-white/5 p-5 md:p-6">
            <div class="text-2xl md:text-3xl font-extrabold tracking-tight">${escapeHtml(t('startTitle'))}</div>
            <div class="mt-2 text-white/70">${escapeHtml(t('startSubtitle'))}</div>
            <button id="startQuiz" class="mt-6 w-full ring-focus btn-primary px-6 py-3.5 rounded-2xl font-extrabold inline-flex items-center justify-center gap-2">
              ${escapeHtml(t('startCTA'))}
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="opacity-90">
                <path d="M8 5l8 7-8 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </div>
      `);
      document.getElementById('startQuiz').addEventListener('click', ()=>renderQuestion(index+1));
      backBtn.onclick = ()=>{};
      return;
    }

    if(q.type === 'single'){
      const opts = q.options.map(o=>{
        const label = o.labelKey ? t(o.labelKey) : (o.label || String(o.value));
        return `
          <button class="opt ring-focus w-full text-left rounded-3xl px-4 py-4" data-val="${escapeHtml(o.value)}">
            <div class="flex items-start justify-between gap-3">
              <div>
                <div class="font-bold text-white/95">${escapeHtml(label)}</div>
                <div class="text-sm text-white/60 mt-1">${escapeHtml(t('clickToAdvance'))}</div>
              </div>
              <span class="text-white/35 mt-1">â†’</span>
            </div>
          </button>
        `;
      }).join('');

      setFade(`
        <div class="fade">
          <div class="mb-4">
            <div class="text-white font-extrabold text-xl tracking-tight">${escapeHtml(t(q.textKey))}</div>
          </div>
          <div class="grid gap-3">${opts}</div>
        </div>
      `);

      app.querySelectorAll('.opt').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const v = btn.dataset.val;
          state.answers[q.id] = (isNaN(Number(v)) ? v : Number(v));
          renderQuestion(index+1);
        });
      });

      backBtn.onclick = ()=>renderQuestion(index-1);
      return;
    }

    if(q.type === 'multi'){
      const current = Array.isArray(state.answers[q.id]) ? state.answers[q.id] : [];
      const min = q.min || 1;

      const chips = q.options.map(o=>{
        const label = o.labelKey ? t(o.labelKey) : (o.label || String(o.value));
        const active = current.includes(o.value);
        return `
          <button type="button"
            class="ring-focus px-4 py-3 rounded-2xl border text-sm font-semibold transition-all
              ${active ? 'bg-white text-slate-900 border-white' : 'bg-white/6 hover:bg-white/10 text-white border-white/10'}"
            data-val="${escapeHtml(o.value)}">
            ${escapeHtml(label)}
          </button>
        `;
      }).join('');

      const canContinue = current.length >= min;

      setFade(`
        <div class="fade">
          <div class="mb-4">
            <div class="text-white font-extrabold text-xl tracking-tight">${escapeHtml(t(q.textKey))}</div>
            <div class="text-white/60 text-sm mt-1">${escapeHtml(t('pickMulti'))}</div>
          </div>

          <div class="flex flex-wrap gap-2.5 mb-5">${chips}</div>

          <div class="flex items-center justify-between gap-3">
            <div class="text-xs text-white/55">${escapeHtml(currentLang==='en' ? `Selected: ${current.length}` : `Selecionados: ${current.length}`)}</div>
            <button id="multiNext"
              class="ring-focus px-5 py-3 rounded-2xl font-extrabold
                ${canContinue ? 'btn-primary text-white' : 'bg-white/10 text-white/45 cursor-not-allowed'}"
              ${canContinue ? '' : 'disabled'}>
              ${escapeHtml(t('next'))}
            </button>
          </div>
        </div>
      `);

      app.querySelectorAll('button[data-val]').forEach(ch=>{
        ch.addEventListener('click', ()=>{
          const val = ch.dataset.val;
          let cur = Array.isArray(state.answers[q.id]) ? state.answers[q.id].slice() : [];
          if(cur.includes(val)) cur = cur.filter(x=>x!==val);
          else cur.push(val);
          state.answers[q.id] = cur;
          renderQuestion(index);
        });
      });

      document.getElementById('multiNext').addEventListener('click', ()=>{
        const cur = Array.isArray(state.answers[q.id]) ? state.answers[q.id] : [];
        if(cur.length < min) return;
        renderQuestion(index+1);
      });

      backBtn.onclick = ()=>renderQuestion(index-1);
      return;
    }

    renderQuestion(index+1);
  };

  // =========================
  // 11) Resultados + redirect por idioma
  // =========================
  const applyPackage = (items)=>{
    selectedMap.clear();
    items.forEach(it=>selectedMap.set(it.id, {id:it.id, period:it.period}));
  };

  const toggleService = (id)=>{
    if(selectedMap.has(id)) selectedMap.delete(id);
    else{
      const s = getServiceById(id);
      if(!s) return;
      selectedMap.set(id, {id, period: s.__isPlan ? 'Mensal' : undefined});
    }
  };

  const updatePlanPeriod = (id, period)=>{
    const it = selectedMap.get(id);
    if(it){ it.period = period; selectedMap.set(id, it); }
  };

  const findServiceByRegex = (re)=> allServices.find(s => re.test((s.__displayTitle||'')+' '+(s.titulo||'')+' '+(s.descricao||'')));

  const buildPackages = (a, topList)=>{
    const budget = Number(a.orcamento) || Infinity;
    const withinBudget = (s)=>{
      if(!s) return false;
      if(budget === 999999) return true;
      if(typeof s.__priceMin !== 'number') return true;
      return s.__priceMin <= budget;
    };

    const bestImages = topList.find(s => /imagens/i.test(s.__categoria));
    const bestVideo  = topList.find(s => /vÃ­deos|videos/i.test(s.__categoria));
    const bestPlan   = topList.find(s => s.__isPlan);

    const identity = findServiceByRegex(/\bidentidade\b|\blogo\b/i);
    const website  = findServiceByRegex(/\bwebsite\b|\bsite\b/i);
    const narra    = findServiceByRegex(/\bnarra/i);

    const mats = Array.isArray(a.materiais) ? a.materiais : [];
    const needsIdentity = mats.includes('nada') || !mats.includes('tem_logo');

    const essential = [];
    if(a.objetivo === 'social' && (a.frequencia === 'mensal' || a.frequencia === 'semanal') && bestPlan && withinBudget(bestPlan)){
      essential.push({id: bestPlan.__id, period:'Mensal'});
    } else {
      if(bestImages && withinBudget(bestImages)) essential.push({id: bestImages.__id});
      if(bestVideo && withinBudget(bestVideo) && (a.objetivo==='vendas' || a.objetivo==='educativo')) essential.push({id: bestVideo.__id});
      if(!essential.length && topList[0]) essential.push({id: topList[0].__id});
    }

    const recommended = essential.slice();
    if(needsIdentity && identity && withinBudget(identity) && !recommended.find(x=>x.id===identity.__id)) recommended.unshift({id: identity.__id});
    if(narra && withinBudget(narra) && !recommended.find(x=>x.id===narra.__id) && (a.objetivo!=='branding')) recommended.push({id: narra.__id});
    if(a.objetivo === 'social' && bestPlan && withinBudget(bestPlan) && !recommended.find(x=>x.id===bestPlan.__id)) recommended.unshift({id: bestPlan.__id, period:'Mensal'});

    const aggressive = recommended.slice();
    if(a.objetivo === 'branding' && website && withinBudget(website) && !aggressive.find(x=>x.id===website.__id)) aggressive.push({id: website.__id});
    topList.slice(0,6).forEach(s=>{
      if(aggressive.length >= 6) return;
      if(!aggressive.find(x=>x.id===s.__id) && withinBudget(s)){
        aggressive.push({id: s.__id, period: s.__isPlan ? 'Mensal' : undefined});
      }
    });

    return [
      { tierKey:'tier_essential', badgeKey:'badge_essential', idx:0, items: essential },
      { tierKey:'tier_recommended', badgeKey:'badge_recommended', idx:1, items: recommended },
      { tierKey:'tier_aggressive', badgeKey:'badge_aggressive', idx:2, items: aggressive }
    ];
  };

  const servicesForChecklist = (topList)=>{
    const seen = new Set();
    const list = [];
    const byCat = {};
    topList.forEach(s=>{
      byCat[s.__categoria] = byCat[s.__categoria] || [];
      byCat[s.__categoria].push(s);
    });
    Object.keys(byCat).forEach(cat=>{
      byCat[cat].slice(0,2).forEach(s=>{
        if(!seen.has(s.__id)){ list.push(s); seen.add(s.__id); }
      });
    });
    topList.forEach(s=>{
      if(list.length >= 12) return;
      if(!seen.has(s.__id)){ list.push(s); seen.add(s.__id); }
    });
    return list.slice(0,12);
  };

  const buildSummaryText = ()=>{
    const a = state.answers;
    const canais = Array.isArray(a.canais) ? a.canais.join(', ') : String(a.canais||'');
    const mats = Array.isArray(a.materiais) ? a.materiais.join(', ') : String(a.materiais||'');
    const tipo = (a.tipo === '__AUTO__') ? t('type_auto') : a.tipo;
    const prazo = (a.prazo === '__SKIP__') ? t('d_skip') : (a.prazo || 'â€”');

    const totals = computeTotals(Array.from(selectedMap.values()));
    const totalsLine = currentLang === 'en'
      ? `\n- Estimated total: ${formatPrice(totals.total)}`
      : `\n- Total estimado: ${formatPrice(totals.total)}`;

    if(currentLang === 'en'){
      return [
        `- Goal: ${a.objetivo}`,
        `- Channels: ${canais}`,
        `- Frequency: ${a.frequencia}`,
        `- Type: ${tipo}`,
        `- Assets: ${mats}`,
        `- Volume: ${a.volume}`,
        `- Style: ${a.estilo}`,
        `- Preference: ${a.formato}`,
        `- Budget: R$${a.orcamento}`,
        `- Deadline: ${prazo}`
      ].join('\n') + totalsLine;
    }
    return [
      `- Objetivo: ${a.objetivo}`,
      `- Canais: ${canais}`,
      `- FrequÃªncia: ${a.frequencia}`,
      `- Tipo: ${tipo}`,
      `- Materiais: ${mats}`,
      `- Volume: ${a.volume}`,
      `- Estilo: ${a.estilo}`,
      `- PreferÃªncia: ${a.formato}`,
      `- OrÃ§amento: R$${a.orcamento}`,
      `- Prazo: ${prazo}`
    ].join('\n') + totalsLine;
  };

  const renderResults = ()=>{
    updateProgress();
    renderSideSummary();
    showNavButtons(false, false);

    const required = ['objetivo','canais','frequencia','tipo','materiais','volume','estilo','formato','orcamento','prazo'];
    for(const r of required){
      if(typeof state.answers[r] === 'undefined'){
        const idx = questions.findIndex(q=>q.id===r);
        renderQuestion(idx >= 0 ? idx : 0);
        return;
      }
    }

    const topList = pickTopServices(state.answers, 14);
    const packages = buildPackages(state.answers, topList);

    if(selectedMap.size === 0){
      applyPackage((packages[1] || packages[0]).items);
    }

    const selectedArr = Array.from(selectedMap.values());
    const totals = computeTotals(selectedArr);
    renderTotalsBox(totals);

    const pkgHtml = packages.map(pkg=>{
      const tier = t(pkg.tierKey);
      const badge = t(pkg.badgeKey);
      const highlight = pkg.idx === 1;

      const simTotals = computeTotals(pkg.items);
      const itemsList = pkg.items.map(it=>{
        const s = getServiceById(it.id);
        if(!s) return '';
        const planTxt = s.__isPlan ? `<span class="text-xs text-white/50">(Mensal)</span>` : '';
        return `<li class="text-sm text-white/80">${escapeHtml(s.__displayTitle)} ${planTxt}</li>`;
      }).join('');

      return `
        <div class="rounded-3xl p-4 md:p-5 border ${highlight ? 'border-white/25 bg-white/10' : 'border-white/10 bg-white/5'}">
          <div class="flex items-center justify-between gap-3">
            <div class="text-lg font-extrabold">${escapeHtml(tier)}</div>
            <span class="text-xs px-2 py-1 rounded-full border border-white/10 bg-white/5 text-white/80 font-semibold">${escapeHtml(badge)}</span>
          </div>

          <ul class="mt-3 list-disc list-inside space-y-1">${itemsList}</ul>

          <div class="mt-4 flex items-end justify-between gap-3">
            <div>
              <div class="text-xs text-white/55">${escapeHtml(t('estimatedTotal'))}</div>
              <div class="text-xl font-extrabold text-emerald-300">${formatPrice(simTotals.total)}</div>
            </div>
            <button class="applyPkg ring-focus px-4 py-2.5 rounded-2xl font-extrabold ${highlight ? 'btn-primary text-white' : 'bg-white text-slate-900'}"
              data-idx="${pkg.idx}">
              ${escapeHtml(t('apply'))}
            </button>
          </div>

          <div class="mt-3 text-xs text-white/50">${escapeHtml(t('simulated'))}</div>
        </div>
      `;
    }).join('');

    const checklistItems = servicesForChecklist(topList).map(s=>{
      const checked = selectedMap.has(s.__id) ? 'checked' : '';
      const priceLabel = s.__isPlan
        ? (s.precos_por_periodo?.[0]?.preco_total_com_desc ? `${formatPrice(s.precos_por_periodo[0].preco_total_com_desc)}` : 'â€”')
        : formatPrice(s.__priceMin ?? s.preco ?? 0);

      let planSelect = '';
      if(s.__isPlan && selectedMap.has(s.__id)){
        const it = selectedMap.get(s.__id);
        const opts = (Array.isArray(s.precos_por_periodo) ? s.precos_por_periodo : []).map(p=>{
          const selected = (String(it.period||'Mensal').toLowerCase() === String(p.periodo).toLowerCase()) ? 'selected' : '';
          const econ = (Number(p.preco_total_sem_desc||0) - Number(p.preco_total_com_desc||0));
          const econTxt = econ > 0 ? ` â€¢ ${t('saves')} ${formatPrice(econ)}` : '';
          return `<option value="${escapeHtml(p.periodo)}" ${selected}>${escapeHtml(p.periodo)} â€” ${formatPrice(p.preco_total_com_desc)}${econTxt}</option>`;
        }).join('');
        planSelect = `
          <div class="mt-3">
            <label class="text-xs text-white/55">${escapeHtml(t('planPeriod'))}</label>
            <select class="planPeriod ring-focus mt-1 w-full border border-white/10 bg-white/6 rounded-2xl px-3 py-2.5 text-sm text-white"
              data-id="${escapeHtml(s.__id)}">
              ${opts}
            </select>
          </div>
        `;
      }

      return `
        <label class="rounded-3xl border border-white/10 bg-white/5 hover:bg-white/10 transition-all p-4 flex gap-3">
          <input type="checkbox" class="svcCheck mt-1.5 h-4 w-4 accent-indigo-400" data-id="${escapeHtml(s.__id)}" ${checked}>
          <div class="flex-1">
            <div class="flex items-start justify-between gap-3">
              <div>
                <div class="font-bold text-white/95">${escapeHtml(s.__displayTitle)}</div>
                <div class="text-xs text-white/50 mt-0.5">${escapeHtml(s.__categoria)}</div>
              </div>
              <div class="text-emerald-300 font-extrabold whitespace-nowrap">${escapeHtml(priceLabel)}</div>
            </div>
            <div class="mt-2 text-sm text-white/70">
              ${escapeHtml((s.descricao||'').slice(0,165))}${(s.descricao||'').length>165?'â€¦':''}
            </div>
            ${planSelect}
          </div>
        </label>
      `;
    }).join('');

    const summaryText = buildSummaryText();

    setFade(`
      <div class="fade">
        <div class="flex items-start justify-between gap-3 mb-5">
          <div>
            <div class="text-2xl md:text-3xl font-extrabold tracking-tight">${escapeHtml(t('resultsTitle'))}</div>
            <div class="text-white/65 text-sm mt-1">${escapeHtml(t('resultsSub'))}</div>
          </div>
          <button id="redo" class="ring-focus px-4 py-2.5 rounded-2xl btn-ghost font-bold">${escapeHtml(t('redo'))}</button>
        </div>

        <div class="grid md:grid-cols-3 gap-3 mb-6">
          ${pkgHtml}
        </div>

        <div class="flex items-center justify-between gap-3 mb-2">
          <div class="text-white font-extrabold text-lg">${escapeHtml(t('customizeTitle'))}</div>
          <div class="text-xs text-white/55">${escapeHtml(t('customizeHint'))}</div>
        </div>

        <div class="grid gap-3 mb-6">${checklistItems}</div>

        <div class="rounded-3xl border border-white/10 bg-white/5 p-4 md:p-5 mb-5">
          <div class="text-white font-extrabold mb-2">${escapeHtml(t('summaryAuto'))}</div>
          <pre class="whitespace-pre-wrap text-sm text-white/80">${escapeHtml(summaryText)}</pre>
        </div>

        <div class="flex flex-col sm:flex-row gap-3">
          <button id="finalize" class="ring-focus btn-primary flex-1 px-6 py-3.5 rounded-2xl font-extrabold inline-flex items-center justify-center gap-2">
            ${escapeHtml(t('finalize'))}
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="opacity-90">
              <path d="M8 5l8 7-8 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button id="copy" class="ring-focus btn-ghost px-6 py-3.5 rounded-2xl font-extrabold">${escapeHtml(t('copy'))}</button>
        </div>

        <div class="mt-4 text-xs text-white/55">
          ${escapeHtml(t('notes'))}: ${escapeHtml(observacoes || 'â€”')}
        </div>
      </div>
    `);

    document.querySelectorAll('.applyPkg').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const idx = Number(btn.dataset.idx);
        const pkg = packages.find(p=>p.idx===idx);
        if(pkg){
          applyPackage(pkg.items);
          renderResults();
        }
      });
    });

    document.querySelectorAll('.svcCheck').forEach(ch=>{
      ch.addEventListener('change', ()=>{
        toggleService(ch.dataset.id);
        renderTotalsBox(computeTotals(Array.from(selectedMap.values())));
        renderResults();
      });
    });

    document.querySelectorAll('.planPeriod').forEach(sel=>{
      sel.addEventListener('change', ()=>{
        updatePlanPeriod(sel.dataset.id, sel.value);
        renderTotalsBox(computeTotals(Array.from(selectedMap.values())));
      });
    });

    document.getElementById('redo').addEventListener('click', ()=>{
      state.answers = {};
      state.index = 0;
      selectedMap.clear();
      renderTotalsBox({avulsoSubtotal:0,comboPerc:0,comboDiscount:0,planTotal:0,planSavings:0,total:0});
      renderQuestion(0);
    });

    document.getElementById('copy').addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText(summaryText);
        const b = document.getElementById('copy');
        b.textContent = t('copied');
        setTimeout(()=>b.textContent = t('copy'), 1200);
      }catch(e){
        alert(currentLang==='en'
          ? 'Could not copy automatically. Please select and copy manually.'
          : 'NÃ£o foi possÃ­vel copiar automaticamente. Selecione e copie manualmente.');
      }
    });

    document.getElementById('finalize').addEventListener('click', ()=>{
      const selectedDetail = Array.from(selectedMap.values()).map(it=>{
        const s = getServiceById(it.id);
        if(!s) return null;

        let price = s.__priceMin ?? s.preco ?? 0;
        if(s.__isPlan && Array.isArray(s.precos_por_periodo)){
          const opt = s.precos_por_periodo.find(p => String(p.periodo).toLowerCase() === String(it.period||'Mensal').toLowerCase())
                   || s.precos_por_periodo[0];
          if(opt) price = Number(opt.preco_total_com_desc || price);
        }

        return {
          category: s.__categoria,
          title: s.__displayTitle,
          kind: s.__isPlan ? 'plan' : 'one_off',
          period: s.__isPlan ? (it.period || 'Mensal') : undefined,
          price
        };
      }).filter(Boolean);

      const encodedResumo = encodeURIComponent(summaryText);
      const encodedServices = encodeURIComponent(JSON.stringify(selectedDetail));

      const base = (currentLang === 'en')
        ? 'https://www.comercias.com.br/en/orcamento'
        : 'https://www.comercias.com.br/pt/orcamento';

      window.location.href = `${base}?servicos=${encodedServices}&resumo=${encodedResumo}`;
    });
  };

  // =========================
  // 12) Init
  // =========================
  renderTotalsBox({avulsoSubtotal:0,comboPerc:0,comboDiscount:0,planTotal:0,planSavings:0,total:0});

  backBtn.addEventListener('click', ()=>{ if(state.index > 0) renderQuestion(state.index - 1); });
  nextBtn.addEventListener('click', ()=>{ renderQuestion(state.index + 1); });

  // aplica idioma e sÃ³ depois marca como initialized e renderiza
  applyCopy();
  initialized = true;
  setLang(currentLang);
  renderQuestion(0);
})();
</script>
</body>
</html>
